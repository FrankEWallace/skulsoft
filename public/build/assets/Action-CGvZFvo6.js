import{k as Y,u as S,i as E,j as K,H as U,I as W,p as z,m as B,q as G,r as i,t as R,o as h,w as m,d as r,a as H,e as l,f as n,b as J,v as k,x as p,F as T,y as Q,N as X,K as Z}from"./app-Cvm44xuh.js";const x={class:"grid grid-cols-4 gap-6"},ee={class:"col-span-4 sm:col-span-1"},ae={class:"col-span-4 sm:col-span-1"},se={class:"col-span-4 sm:col-span-1"},te=["onClick"],oe={class:"mt-4 grid grid-cols-4 gap-4"},re={class:"col-span-4 sm:col-span-1"},ne={class:"col-span-4 sm:col-span-3"},ie={class:"mt-4"},le={class:"mt-4 grid grid-cols-1"},de={class:"col"},ce={name:"ResourceDiaryForm"},ue=Object.assign(ce,{setup(P){const f=Y("moment"),d=S();E(),K();const b={batches:[],subject:"",date:f().format("YYYY-MM-DD"),details:[],media:[],mediaUpdated:!1,mediaToken:U(),mediaHash:[]},v={uuid:U(),heading:"",description:""},y="resource/diary/",o=W(y);z(!1);const D=B({subjects:[],statuses:[]});B({subjects:[]});const s=B({...b}),_=B({batches:[],subject:"",isLoaded:!d.params.uuid}),M=t=>{Object.assign(D,t)},O=()=>{s.mediaToken=U(),s.mediaHash=[]},F=()=>{s.details.push({...v,uuid:U()}),_.isLoaded=!0},w=async t=>{await X()&&(s.details.length==1?s.details=[v]:s.details.splice(t,1))},A=t=>{var j,V;let a=t.details.map(g=>({...g})),$=t.records.map(g=>g.batch.uuid)||[];Object.assign(b,{...t,details:a,date:t.date.value,batches:$,subject:((V=(j=t.records[0])==null?void 0:j.subject)==null?void 0:V.uuid)||""}),Object.assign(s,Z(b)),_.batches=$,_.isLoaded=!0};return G(async()=>{d.params.uuid||F()}),(t,a)=>{const $=i("DatePicker"),j=i("BaseSelectSearch"),V=i("BaseSelect"),g=i("BaseInput"),C=i("BaseTextarea"),L=i("BaseFieldset"),q=i("BaseBadge"),N=i("MediaUpload"),I=i("FormAction");return h(),R(I,{"pre-requisites":!0,onSetPreRequisites:M,"init-url":y,"init-form":b,form:s,setForm:A,redirect:"ResourceDiary",onResetMediaFiles:O},{default:m(()=>[r("div",x,[r("div",ee,[l($,{modelValue:s.date,"onUpdate:modelValue":a[0]||(a[0]=e=>s.date=e),name:"date",label:t.$trans("resource.diary.props.date"),"no-clear":"",error:n(o).date,"onUpdate:error":a[1]||(a[1]=e=>n(o).date=e)},null,8,["modelValue","label","error"])]),r("div",ae,[_.isLoaded?(h(),R(j,{key:0,multiple:"",name:"batches",label:t.$trans("academic.batch.batch"),modelValue:s.batches,"onUpdate:modelValue":a[2]||(a[2]=e=>s.batches=e),error:n(o).batches,"onUpdate:error":a[3]||(a[3]=e=>n(o).batches=e),"value-prop":"uuid","init-search":_.batches,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:m(e=>[k(p(e.value.course.name)+" - "+p(e.value.name),1)]),listOption:m(e=>[k(p(e.option.course.nameWithTerm)+" - "+p(e.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):J("",!0)]),r("div",se,[l(V,{modelValue:s.subject,"onUpdate:modelValue":a[4]||(a[4]=e=>s.subject=e),name:"subject",label:t.$trans("academic.subject.subject"),"label-prop":"name","value-prop":"uuid",options:D.subjects,error:n(o).subject,"onUpdate:error":a[5]||(a[5]=e=>n(o).subject=e)},null,8,["modelValue","label","options","error"])])]),(h(!0),H(T,null,Q(s.details,(e,c)=>(h(),R(L,{class:"mt-4",key:e.uuid},{legend:m(()=>[k(p(c+1)+". ",1),r("span",{class:"text-danger ml-2 cursor-pointer",onClick:u=>w(c)},a[8]||(a[8]=[r("i",{class:"fas fa-times-circle"},null,-1)]),8,te)]),default:m(()=>[r("div",oe,[r("div",re,[l(g,{type:"text",modelValue:e.heading,"onUpdate:modelValue":u=>e.heading=u,name:`details.${c}.heading`,label:t.$trans("resource.diary.props.heading"),error:n(o)[`details.${c}.heading`],"onUpdate:error":u=>n(o)[`details.${c}.heading`]=u},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])]),r("div",ne,[l(C,{rows:1,modelValue:e.description,"onUpdate:modelValue":u=>e.description=u,name:`details.${c}.description`,label:t.$trans("resource.diary.props.description"),error:n(o)[`details.${c}.description`],"onUpdate:error":u=>n(o)[`details.${c}.description`]=u},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])])])]),_:2},1024))),128)),r("div",ie,[l(q,{design:"primary",onClick:F,class:"cursor-pointer"},{default:m(()=>[k(p(t.$trans("global.add",{attribute:t.$trans("general.detail")})),1)]),_:1})]),r("div",le,[r("div",de,[l(N,{multiple:"",label:t.$trans("general.file"),module:"student_diary",media:s.media,"media-token":s.mediaToken,onIsUpdated:a[6]||(a[6]=e=>s.mediaUpdated=!0),onSetHash:a[7]||(a[7]=e=>s.mediaHash.push(e))},null,8,["label","media","media-token"])])])]),_:1},8,["form"])}}}),me={name:"ResourceDiaryAction"},be=Object.assign(me,{setup(P){const f=S();return(d,b)=>{const v=i("PageHeaderAction"),y=i("PageHeader"),o=i("ParentTransition");return h(),H(T,null,[l(y,{title:d.$trans(n(f).meta.trans,{attribute:d.$trans(n(f).meta.label)}),navs:[{label:d.$trans("resource.resource"),path:"Resource"},{label:d.$trans("resource.diary.diary"),path:"ResourceDiaryList"}]},{default:m(()=>[l(v,{name:"ResourceDiary",title:d.$trans("resource.diary.diary"),actions:["list"]},null,8,["title"])]),_:1},8,["title","navs"]),l(o,{appear:"",visibility:!0},{default:m(()=>[l(ue)]),_:1})],64)}}});export{be as default};
