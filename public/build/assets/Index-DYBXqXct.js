import{u as Q,m as F,q as x,r as y,t as f,o as i,w as e,d as v,e as r,b as g,v as l,x as t,i as Y,j as ee,k as G,I as te,p as E,f as d,a as R,Y as ae,F as H,y as J,z as P,aj as ne}from"./app-Cvm44xuh.js";const se={class:"grid grid-cols-3 gap-6"},oe={class:"col-span-3 sm:col-span-1"},le={class:"col-span-3 sm:col-span-1"},ie={class:"col-span-3 sm:col-span-1"},re={class:"col-span-3 sm:col-span-1"},de={class:"col-span-3 sm:col-span-1"},ue={class:"col-span-3 sm:col-span-1"},ce={class:"col-span-3 sm:col-span-1"},me={class:"col-span-3 sm:col-span-1"},pe={class:"col-span-3 sm:col-span-1"},fe={class:"col-span-3 sm:col-span-1"},ge={class:"col-span-3 sm:col-span-1"},ye={class:"col-span-3 sm:col-span-1"},be={class:"col-span-3 sm:col-span-1"},ke={class:"col-span-3 sm:col-span-1"},_e={__name:"Filter",props:{preRequisites:{type:Object,default(){return{}}}},emits:["hide"],setup($,{emit:D}){const m=Q(),b=D,C=$,L={codeNumber:"",types:[],categories:[],paymentMethods:[],employees:[],onlinePaymentMethods:[],period:"",ledgers:[],secondaryLedgers:[],startDate:"",endDate:"",status:"",head:"",pgAccount:"",pendingClearance:!1},o=F({...L}),k=F({isLoaded:!(m.query.types||m.query.categories||m.query.paymentMethods||m.query.employees||m.query.onlinePaymentMethods||m.query.ledgers||m.query.secondaryLedgers)}),M=F({periods:C.preRequisites.periods,types:C.preRequisites.types,categories:C.preRequisites.categories,heads:C.preRequisites.heads,paymentMethods:C.preRequisites.paymentMethods,onlinePaymentMethods:C.preRequisites.onlinePaymentMethods});return x(async()=>{k.types=m.query.types?m.query.types.split(","):[],k.categories=m.query.categories?m.query.categories.split(","):[],k.paymentMethods=m.query.paymentMethods?m.query.paymentMethods.split(","):[],k.employees=m.query.employees?m.query.employees.split(","):[],k.onlinePaymentMethods=m.query.onlinePaymentMethods?m.query.onlinePaymentMethods.split(","):[],k.ledgers=m.query.ledgers?m.query.ledgers.split(","):[],k.secondaryLedgers=m.query.secondaryLedgers?m.query.secondaryLedgers.split(","):[],k.isLoaded=!0}),(p,s)=>{const N=y("BaseInput"),q=y("BaseSelect"),V=y("BaseSelectSearch"),T=y("DatePicker"),u=y("BaseSwitch"),c=y("FilterForm");return i(),f(c,{"init-form":L,form:o,multiple:["employees","ledgers","types","categories","paymentMethods","onlinePaymentMethods","secondaryLedgers"],onHide:s[15]||(s[15]=n=>b("hide"))},{default:e(()=>[v("div",se,[v("div",oe,[r(N,{type:"text",modelValue:o.codeNumber,"onUpdate:modelValue":s[0]||(s[0]=n=>o.codeNumber=n),name:"codeNumber",label:p.$trans("finance.transaction.props.code_number")},null,8,["modelValue","label"])]),v("div",le,[r(q,{multiple:"",modelValue:o.types,"onUpdate:modelValue":s[1]||(s[1]=n=>o.types=n),name:"types",label:p.$trans("finance.transaction.props.type"),options:M.types},null,8,["modelValue","label","options"])]),v("div",ie,[r(q,{multiple:"",modelValue:o.categories,"onUpdate:modelValue":s[2]||(s[2]=n=>o.categories=n),name:"categories",label:p.$trans("finance.transaction.category.category"),"label-prop":"name","value-prop":"uuid",options:M.categories},null,8,["modelValue","label","options"])]),v("div",re,[k.isLoaded?(i(),f(V,{key:0,multiple:"",name:"employees",label:p.$trans("global.select",{attribute:p.$trans("employee.employee")}),modelValue:o.employees,"onUpdate:modelValue":s[3]||(s[3]=n=>o.employees=n),"value-prop":"uuid","init-search":k.employees,"search-key":"name","search-action":"employee/list"},{selectedOption:e(n=>[l(t(n.value.name)+" ("+t(n.value.codeNumber)+") ",1)]),listOption:e(n=>[l(t(n.option.name)+" ("+t(n.option.codeNumber)+") ",1)]),_:1},8,["label","modelValue","init-search"])):g("",!0)]),v("div",de,[r(q,{multiple:"",modelValue:o.paymentMethods,"onUpdate:modelValue":s[4]||(s[4]=n=>o.paymentMethods=n),name:"paymentMethods",label:p.$trans("finance.payment_method.payment_method"),"label-prop":"name","value-prop":"uuid",options:M.paymentMethods},null,8,["modelValue","label","options"])]),v("div",ue,[r(q,{multiple:"",modelValue:o.onlinePaymentMethods,"onUpdate:modelValue":s[5]||(s[5]=n=>o.onlinePaymentMethods=n),name:"onlinePaymentMethods",label:p.$trans("finance.payment_method.online_payment_method"),"label-prop":"name","value-prop":"uuid",options:M.onlinePaymentMethods},null,8,["modelValue","label","options"])]),v("div",ce,[r(q,{name:"period",label:p.$trans("global.select",{attribute:p.$trans("academic.period.period")}),modelValue:o.period,"onUpdate:modelValue":s[6]||(s[6]=n=>o.period=n),"label-prop":"name","value-prop":"uuid",options:M.periods},null,8,["label","modelValue","options"])]),v("div",me,[k.isLoaded?(i(),f(V,{key:0,multiple:"",name:"ledgers",label:p.$trans("global.select",{attribute:p.$trans("finance.ledger.ledger")}),modelValue:o.ledgers,"onUpdate:modelValue":s[7]||(s[7]=n=>o.ledgers=n),"label-props":"name","value-prop":"uuid","init-search":k.ledgers,"search-action":"finance/ledger/list"},null,8,["label","modelValue","init-search"])):g("",!0)]),v("div",pe,[k.isLoaded?(i(),f(V,{key:0,multiple:"",name:"secondaryLedgers",label:p.$trans("global.select",{attribute:p.$trans("finance.ledger.secondary_ledger")}),modelValue:o.secondaryLedgers,"onUpdate:modelValue":s[8]||(s[8]=n=>o.secondaryLedgers=n),"label-props":"name","value-prop":"uuid","init-search":k.secondaryLedgers,"search-action":"finance/ledger/list"},null,8,["label","modelValue","init-search"])):g("",!0)]),v("div",fe,[r(T,{start:o.startDate,"onUpdate:start":s[9]||(s[9]=n=>o.startDate=n),end:o.endDate,"onUpdate:end":s[10]||(s[10]=n=>o.endDate=n),name:"dateBetween",as:"range",label:p.$trans("general.date_between")},null,8,["start","end","label"])]),v("div",ge,[r(q,{name:"status",label:p.$trans("global.select",{attribute:p.$trans("finance.transaction.props.status")}),modelValue:o.status,"onUpdate:modelValue":s[11]||(s[11]=n=>o.status=n),options:$.preRequisites.statuses},null,8,["label","modelValue","options"])]),v("div",ye,[r(q,{name:"head",label:p.$trans("global.select",{attribute:p.$trans("finance.transaction.props.head")}),modelValue:o.head,"onUpdate:modelValue":s[12]||(s[12]=n=>o.head=n),options:$.preRequisites.heads},null,8,["label","modelValue","options"])]),v("div",be,[r(N,{type:"text",modelValue:o.pgAccount,"onUpdate:modelValue":s[13]||(s[13]=n=>o.pgAccount=n),name:"pgAccount",label:p.$trans("finance.config.props.pg_account")},null,8,["modelValue","label"])]),v("div",ke,[r(u,{modelValue:o.pendingClearance,"onUpdate:modelValue":s[14]||(s[14]=n=>o.pendingClearance=n),name:"pendingClearance",label:p.$trans("finance.transaction.pending_clearance")},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},ve={class:"grid grid-cols-1 sm:grid-cols-3 gap-x-4 gap-y-8"},he={class:"mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4"},$e={class:"col-span-3 sm:col-span-1"},Ve={name:"FinanceTransactionMarkAsClearedForm"},Me=Object.assign(Ve,{props:{visibility:{type:Boolean,default:!1},transaction:{type:Object,default(){return{}}}},emits:["close","refresh"],setup($,{emit:D}){Q(),Y(),ee();const m=D,b=G("$trans"),C={clearingDate:""},L="finance/transaction/",o=te(L),k=E(!1);F({});const M=F({...C}),p=()=>{m("close")},s=()=>{m("refresh"),p()},N=q=>{window.open(`/app/students/${q}/fee`,"_blank")};return(q,V)=>{const T=y("BaseBadge"),u=y("BaseDataView"),c=y("TextMuted"),n=y("DatePicker"),j=y("FormAction"),O=y("BaseModal");return $.transaction.uuid?(i(),f(O,{key:0,"is-loading":k.value,show:$.visibility,onClose:p},{title:e(()=>[l(t(d(b)("global.update",{attribute:d(b)("finance.transaction.transaction")}))+" ",1),$.transaction.isCancelled?(i(),f(T,{key:0,design:"danger"},{default:e(()=>[l(t(d(b)("general.cancelled")),1)]),_:1})):g("",!0),$.transaction.isRejected?(i(),f(T,{key:1,design:"warning"},{default:e(()=>[l(t(d(b)("general.rejected")),1)]),_:1})):g("",!0)]),default:e(()=>[v("dl",ve,[r(u,{label:d(b)("finance.transaction.props.code_number")},{default:e(()=>[l(t($.transaction.codeNumber)+" ",1),$.transaction.headOrg=="student_fee"?(i(),R("span",{key:0,onClick:V[0]||(V[0]=ae(_=>N($.transaction.transactionable.uuid),["stop"])),class:"cursor-pointer"},V[3]||(V[3]=[v("i",{class:"fas fa-up-right-from-square"},null,-1)]))):g("",!0)]),_:1},8,["label"]),r(u,{label:d(b)("finance.transaction.props.date")},{default:e(()=>[l(t($.transaction.date.formatted),1)]),_:1},8,["label"]),r(u,{label:d(b)("finance.transaction.props.amount")},{default:e(()=>[l(t($.transaction.amount.formatted),1)]),_:1},8,["label"]),r(u,{label:d(b)("finance.payment_method.payment_method")},{default:e(()=>[(i(!0),R(H,null,J($.transaction.payments,_=>(i(),R("div",{key:_.uuid},[l(t(_.methodName)+" "+t(_.amount.formatted)+" ",1),_.hasInstrumentNumber?(i(),f(c,{key:0,block:""},{default:e(()=>[l(t(d(b)("finance.transaction.props.instrument_number"))+": "+t(_.instrumentNumber),1)]),_:2},1024)):g("",!0),_.hasInstrumentDate?(i(),f(c,{key:1,block:""},{default:e(()=>[l(t(d(b)("finance.transaction.props.instrument_date"))+": "+t(_.instrumentDate.formatted),1)]),_:2},1024)):g("",!0),_.hasClearingDate?(i(),f(c,{key:2,block:""},{default:e(()=>[l(t(d(b)("finance.transaction.props.clearing_date"))+": "+t(_.clearingDate.formatted),1)]),_:2},1024)):g("",!0),_.hasBankDetail?(i(),f(c,{key:3,block:""},{default:e(()=>[l(t(d(b)("finance.transaction.props.bank_detail"))+": "+t(_.bankDetail),1)]),_:2},1024)):g("",!0),_.hasReferenceNumber?(i(),f(c,{key:4,block:""},{default:e(()=>[l(t(d(b)("finance.transaction.props.reference_number"))+": "+t(_.referenceNumber),1)]),_:2},1024)):g("",!0)]))),128))]),_:1},8,["label"])]),$.transaction.pendingClearance?(i(),f(j,{key:0,"no-card":"","no-data-fetch":"","is-modal":"",confirmation:"",uuid:$.transaction.uuid,action:"updateClearingDate","init-url":L,"init-form":C,form:M,"keep-adding":!1,"cancel-action":!1,"submit-text":d(b)("global.update",{attribute:d(b)("student.payment.payment")}),"after-submit":s},{default:e(()=>[v("div",he,[v("div",$e,[r(n,{modelValue:M.clearingDate,"onUpdate:modelValue":V[1]||(V[1]=_=>M.clearingDate=_),name:"clearingDate",label:d(b)("finance.transaction.props.clearing_date"),"no-clear":"",error:d(o).clearingDate,"onUpdate:error":V[2]||(V[2]=_=>d(o).clearingDate=_)},null,8,["modelValue","label","error"])])])]),_:1},8,["uuid","form","submit-text"])):g("",!0)]),_:1},8,["is-loading","show"])):g("",!0)}}}),Ce={key:0},qe={key:1},De={name:"FinanceTransactionList"},we=Object.assign(De,{setup($){const D=Y(),m=G("emitter");let b=["filter"];P("transaction:create")&&b.unshift("create");let C=[];P("transaction:export")&&(C=["print","pdf","excel"]);const L="finance/transaction/",o=F({types:[],paymentMethods:[]}),k=E(!1),M=E(!1),p=F({}),s=F({}),N=u=>{Object.assign(p,u)},q=u=>{Object.assign(o,u)},V=u=>{u.isEditable&&(Object.assign(s,u),M.value=!0)},T=u=>{let c="";u.headOrg=="student_fee"?c="/app/students/"+u.transactionable.uuid+"/transactions/"+u.uuid+"/export?action=print":c="/app/finance/transactions/"+u.uuid+"/export";let n={};window.open(ne(c,n),"_blank").focus()};return(u,c)=>{const n=y("BaseButton"),j=y("PageHeaderAction"),O=y("PageHeader"),_=y("ParentTransition"),U=y("TextMuted"),I=y("BaseBadge"),B=y("DataCell"),S=y("FloatingMenuItem"),K=y("FloatingMenu"),W=y("DataRow"),X=y("DataTable"),Z=y("ListItem");return i(),R(H,null,[r(Z,{"init-url":L,"pre-requisites":!0,onSetPreRequisites:q,onSetItems:N},{header:e(()=>[r(O,{title:u.$trans("finance.transaction.transaction"),navs:[{label:u.$trans("finance.finance"),path:"Finance"}]},{default:e(()=>[r(j,{url:"finance/transactions/",name:"FinanceTransaction",title:u.$trans("finance.transaction.transaction"),actions:d(b),"dropdown-actions":d(C),onToggleFilter:c[1]||(c[1]=a=>k.value=!k.value)},{after:e(()=>[d(P)("finance:config")?(i(),f(n,{key:0,design:"white",onClick:c[0]||(c[0]=a=>d(D).push({name:"FinanceConfig"}))},{default:e(()=>c[8]||(c[8]=[v("i",{class:"fas fa-cog"},null,-1)])),_:1,__:[8]})):g("",!0)]),_:1},8,["title","actions","dropdown-actions"])]),_:1},8,["title","navs"])]),filter:e(()=>[r(_,{appear:"",visibility:k.value},{default:e(()=>[r(_e,{onRefresh:c[2]||(c[2]=a=>d(m).emit("listItems")),"pre-requisites":o,onHide:c[3]||(c[3]=a=>k.value=!1)},null,8,["pre-requisites"])]),_:1},8,["visibility"])]),default:e(()=>[r(_,{appear:"",visibility:!0},{default:e(()=>[r(X,{header:p.headers,footer:p.footers,meta:p.meta,module:"finance.transaction",onRefresh:c[5]||(c[5]=a=>d(m).emit("listItems"))},{actionButton:e(()=>[d(P)("transaction:create")?(i(),f(n,{key:0,onClick:c[4]||(c[4]=a=>d(D).push({name:"FinanceTransactionCreate"}))},{default:e(()=>[l(t(u.$trans("global.add",{attribute:u.$trans("finance.transaction.transaction")})),1)]),_:1})):g("",!0)]),default:e(()=>[(i(!0),R(H,null,J(p.data,a=>(i(),f(W,{key:a.uuid,onDoubleClick:h=>d(D).push({name:"FinanceTransactionShow",params:{uuid:a.uuid}})},{default:e(()=>[r(B,{name:"codeNumber"},{default:e(()=>[l(t(a.codeNumber)+" ",1),a.referenceNumber?(i(),f(U,{key:0,block:""},{default:e(()=>[l(t(a.referenceNumber),1)]),_:2},1024)):g("",!0),a.isRejected?(i(),f(I,{key:1,design:"warning",size:"sm"},{default:e(()=>[l(t(u.$trans("general.rejected")),1)]),_:1})):g("",!0),a.isCancelled?(i(),f(I,{key:2,design:"danger",size:"sm"},{default:e(()=>[l(t(u.$trans("general.cancelled")),1)]),_:1})):g("",!0),a.isOnline&&!a.isCompleted?(i(),f(I,{key:3,design:"danger",size:"sm"},{default:e(()=>[l(t(u.$trans("general.failed")),1)]),_:1})):g("",!0),a.pendingClearance?(i(),f(I,{key:4,clickable:"",design:"warning",size:"sm",onClick:h=>V(a)},{default:e(()=>[l(t(u.$trans("finance.transaction.pending_clearance")),1)]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024),r(B,{name:"primaryLedger"},{default:e(()=>{var h,w;return[l(t(((w=(h=a.payment)==null?void 0:h.ledger)==null?void 0:w.name)||"-")+" ",1),a.payment?(i(),f(U,{key:0,block:""},{default:e(()=>{var A;return[l(t((A=a.payment)==null?void 0:A.methodName),1)]}),_:2},1024)):g("",!0),a.head?(i(),f(U,{key:1,block:""},{default:e(()=>[l(t(a.head),1)]),_:2},1024)):g("",!0)]}),_:2},1024),r(B,{name:"type"},{default:e(()=>[l(t(a.type.label),1)]),_:2},1024),r(B,{name:"category"},{default:e(()=>{var h;return[l(t(((h=a.category)==null?void 0:h.name)||"-"),1)]}),_:2},1024),r(B,{name:"date"},{default:e(()=>[l(t(a.date.formatted),1)]),_:2},1024),r(B,{name:"amount"},{default:e(()=>[l(t(a.amount.formatted),1)]),_:2},1024),r(B,{name:"secondaryLedger"},{default:e(()=>{var h,w,A,z;return[(h=a.transactionable)!=null&&h.name?(i(),R("span",Ce,t(a.transactionable.name),1)):a.record?(i(),R("span",qe,t((A=(w=a.record)==null?void 0:w.ledger)==null?void 0:A.name),1)):g("",!0),(z=a.transactionable)!=null&&z.detail?(i(),f(U,{key:2,block:""},{default:e(()=>[l(t(a.transactionable.detail),1)]),_:2},1024)):g("",!0),a.transactionable.subDetail?(i(),f(U,{key:3,block:""},{default:e(()=>[l(t(a.transactionable.subDetail),1)]),_:2},1024)):g("",!0)]}),_:2},1024),r(B,{name:"user"},{default:e(()=>{var h,w;return[l(t(((w=(h=a.user)==null?void 0:h.profile)==null?void 0:w.name)||"-"),1)]}),_:2},1024),r(B,{name:"createdAt"},{default:e(()=>[l(t(a.createdAt.formatted),1)]),_:2},1024),r(B,{name:"action"},{default:e(()=>[r(K,null,{default:e(()=>[r(S,{icon:"fas fa-arrow-circle-right",onClick:h=>d(D).push({name:"FinanceTransactionShow",params:{uuid:a.uuid}})},{default:e(()=>[l(t(u.$trans("general.show")),1)]),_:2},1032,["onClick"]),r(S,{icon:"fas fa-print",onClick:h=>T(a)},{default:e(()=>[l(t(u.$trans("global.print",{attribute:u.$trans("finance.transaction.transaction")})),1)]),_:2},1032,["onClick"]),d(P)("transaction:edit")&&a.isEditable?(i(),f(S,{key:0,icon:"fas fa-edit",onClick:h=>d(D).push({name:"FinanceTransactionEdit",params:{uuid:a.uuid}})},{default:e(()=>[l(t(u.$trans("general.edit")),1)]),_:2},1032,["onClick"])):g("",!0),d(P)("transaction:create")&&a.isEditable?(i(),f(S,{key:1,icon:"fas fa-copy",onClick:h=>d(D).push({name:"FinanceTransactionDuplicate",params:{uuid:a.uuid}})},{default:e(()=>[l(t(u.$trans("general.duplicate")),1)]),_:2},1032,["onClick"])):g("",!0),d(P)("transaction:delete")&&a.isEditable?(i(),f(S,{key:2,icon:"fas fa-trash",onClick:h=>d(m).emit("deleteItem",{uuid:a.uuid})},{default:e(()=>[l(t(u.$trans("general.delete")),1)]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onDoubleClick"]))),128))]),_:1},8,["header","footer","meta"])]),_:1})]),_:1}),s.uuid?(i(),f(Me,{key:0,visibility:M.value,transaction:s,onClose:c[6]||(c[6]=a=>M.value=!1),onRefresh:c[7]||(c[7]=a=>d(m).emit("listItems"))},null,8,["visibility","transaction"])):g("",!0)],64)}}});export{we as default};
