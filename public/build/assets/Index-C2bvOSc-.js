import{u as j,m as A,I as L,q as E,r as i,t as v,o as p,w as t,d as g,b as V,f as m,v as d,x as r,e as n,i as Z,j as x,k as ee,p as ae,L as te,a as U,F as N,y as oe}from"./app-Cvm44xuh.js";import{i as ne,t as le,a as se}from"./table-FwhM-Z75.js";const re={class:"grid grid-cols-3 gap-6"},ie={class:"col-span-3 sm:col-span-1"},de={class:"col-span-3 sm:col-span-1"},me={__name:"Filter",props:{initUrl:{type:String,default:""}},emits:["hide"],setup(C,{emit:_}){const S=j(),w=_,k=C,b={name:"",batch:""},h=A({...b}),u=L(k.initUrl),f=A({batch:"",isLoaded:!S.query.batch});return E(async()=>{f.batch=S.query.batch,f.isLoaded=!0}),(l,o)=>{const F=i("BaseSelectSearch"),B=i("BaseInput"),q=i("FilterForm");return p(),v(q,{"init-form":b,form:h,onHide:o[3]||(o[3]=c=>w("hide"))},{default:t(()=>[g("div",re,[g("div",ie,[f.isLoaded?(p(),v(F,{key:0,name:"batch",label:l.$trans("global.select",{attribute:l.$trans("academic.batch.batch")}),modelValue:h.batch,"onUpdate:modelValue":o[0]||(o[0]=c=>h.batch=c),error:m(u).batch,"onUpdate:error":o[1]||(o[1]=c=>m(u).batch=c),"value-prop":"uuid","init-search":f.batch,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:t(c=>[d(r(c.value.course.name)+" "+r(c.value.name),1)]),listOption:t(c=>[d(r(c.option.course.nameWithTerm)+" "+r(c.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):V("",!0)]),g("div",de,[n(B,{type:"text",modelValue:h.name,"onUpdate:modelValue":o[2]||(o[2]=c=>h.name=c),name:"name",label:l.$trans("student.props.name")},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},ue={class:"p-2"},ce={class:"grid grid-cols-3 gap-6"},pe={class:"col-span-3 sm:col-span-1"},be={class:"mt-4 grid grid-cols-3 gap-6"},fe={key:0,class:"col-span-3 sm:col-span-1"},ge={class:"col-span-3 sm:col-span-1"},_e={key:0,class:"col-span-3 sm:col-span-1"},he={class:"col-span-3 sm:col-span-1"},ve={class:"col-span-3 sm:col-span-1"},ke={class:"dark:text-gray-400"},ye={name:"StudentPromotion"},Be=Object.assign(ye,{setup(C){const _=j();Z();const S=x();ee("emitter");const w={batch:"",name:"",selectAll:!1,students:[],markAsAlumni:!1,period:"",newBatch:"",date:"",assignFee:!1},k="student/promotion/",b=ae(!1),h=A({periods:[]}),u=L(k),f=A({data:[]}),l=A({...w});A({});const o=A({...ne}),F=async()=>{b.value=!0,await S.dispatch(k+"preRequisite").then(s=>{b.value=!1,Object.assign(h,s)}).catch(s=>{b.value=!1})},B=async()=>{b.value=!0,await S.dispatch(k+"fetch",{params:_.query}).then(s=>{b.value=!1,l.batch=_.query.batch,l.name=_.query.name,l.perPage=_.query.perPage,Object.assign(f,s),o.pageItems=s.data.map(a=>a.uuid)}).catch(s=>{b.value=!1})},q=()=>{o.global=!o.global,l.selectAll=o.global},c=async()=>{o.items=[],o.pageItems=[],o.all=!1,l.selectAll=!1,await B()};return te(()=>[o.items,o.pageItems],([s,a],[I,P])=>{l.students=s,o.all=se(o)}),E(async()=>{await F(),_.query.batch&&await B()}),(s,a)=>{const I=i("PageHeaderAction"),P=i("PageHeader"),D=i("ParentTransition"),M=i("BaseAlert"),R=i("BaseCard"),G=i("BaseArrayCheckbox"),W=i("BaseCheckbox"),y=i("DataCell"),$=i("TextMuted"),z=i("DataRow"),J=i("DataTable"),H=i("BaseSwitch"),O=i("DatePicker"),K=i("BaseSelect"),Q=i("BaseSelectSearch"),X=i("HelperText"),Y=i("FormAction");return p(),U(N,null,[n(P,{title:s.$trans(m(_).meta.label),navs:[{label:s.$trans("student.student"),path:"Student"}]},{default:t(()=>[n(I)]),_:1},8,["title","navs"]),n(D,{appear:"",visibility:!0},{default:t(()=>[n(me,{onAfterFilter:B,"init-url":k})]),_:1}),f.data.length==0?(p(),v(R,{key:0,"no-padding":"","no-content-padding":"","is-loading":b.value},{title:t(()=>[d(r(s.$trans("student.promotion.promotion")),1)]),default:t(()=>[g("div",ue,[n(M,{size:"xs",design:"error"},{default:t(()=>[d(r(s.$trans("general.errors.record_not_found")),1)]),_:1})])]),_:1},8,["is-loading"])):V("",!0),f.data.length>0?(p(),v(D,{key:1,appear:"",visibility:!0},{default:t(()=>[n(J,{onToggleSelectAll:a[2]||(a[2]=e=>o.items=m(le)(e,o)),onToggleGlobalSelect:q,selected:o,header:f.headers,meta:f.meta,module:"student.promotion",onRefresh:B},{actionButton:t(()=>a[15]||(a[15]=[])),default:t(()=>[(p(!0),U(N,null,oe(f.data,e=>(p(),v(z,{key:e.uuid},{default:t(()=>[n(y,{name:"selectAll"},{default:t(()=>[o.global?V("",!0):(p(),v(G,{key:0,items:o.items,"onUpdate:items":a[0]||(a[0]=T=>o.items=T),value:e.uuid},null,8,["items","value"])),o.global?(p(),v(W,{key:1,modelValue:o.global,"onUpdate:modelValue":a[1]||(a[1]=T=>o.global=T)},null,8,["modelValue"])):V("",!0)]),_:2},1024),n(y,{name:"codeNumber"},{default:t(()=>[d(r(e.codeNumber)+" ",1),n($,{block:""},{default:t(()=>[d(r(e.joiningDate.formatted),1)]),_:2},1024)]),_:2},1024),n(y,{name:"name"},{default:t(()=>[d(r(e.name)+" ",1),n($,{block:""},{default:t(()=>[d(r(e.gender.label),1)]),_:2},1024)]),_:2},1024),n(y,{name:"course"},{default:t(()=>[d(r(e.courseName)+" ",1),n($,{block:""},{default:t(()=>[d(r(e.batchName),1)]),_:2},1024)]),_:2},1024),n(y,{name:"birthDate"},{default:t(()=>[d(r(e.birthDate.formatted),1)]),_:2},1024),n(y,{name:"contactNumber"},{default:t(()=>[d(r(e.contactNumber)+" ",1),n($,{block:""},{default:t(()=>[d(r(e.email),1)]),_:2},1024)]),_:2},1024),n(y,{name:"parent"},{default:t(()=>[d(r(e.fatherName)+" ",1),n($,{block:""},{default:t(()=>[d(r(e.motherName),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["selected","header","meta"])]),_:1})):V("",!0),o.items.length>0?(p(),v(D,{key:2,appear:"",visibility:!0},{default:t(()=>[n(R,{"is-loading":b.value},{title:t(()=>[d(r(s.$trans("student.promotion.promote")),1)]),default:t(()=>[n(Y,{"no-card":"","keep-adding":!1,"init-url":k,action:"promote","init-form":w,form:l,"after-submit":c},{default:t(()=>[g("div",ce,[g("div",pe,[n(H,{vertical:"",modelValue:l.markAsAlumni,"onUpdate:modelValue":a[3]||(a[3]=e=>l.markAsAlumni=e),name:"markAsAlumni",label:s.$trans("global.mark",{attribute:s.$trans("student.alumni.alumni")}),error:m(u).markAsAlumni,"onUpdate:error":a[4]||(a[4]=e=>m(u).markAsAlumni=e)},null,8,["modelValue","label","error"])])]),g("div",be,[l.markAsAlumni?(p(),U("div",fe,[n(O,{modelValue:l.date,"onUpdate:modelValue":a[5]||(a[5]=e=>l.date=e),name:"date",label:s.$trans("student.alumni.props.date"),"no-clear":"",error:m(u).date,"onUpdate:error":a[6]||(a[6]=e=>m(u).date=e)},null,8,["modelValue","label","error"])])):(p(),U(N,{key:1},[g("div",ge,[n(K,{modelValue:l.period,"onUpdate:modelValue":a[7]||(a[7]=e=>l.period=e),name:"period",label:s.$trans("academic.period.period"),"label-prop":"name","value-prop":"uuid",options:h.periods,error:m(u).period,"onUpdate:error":a[8]||(a[8]=e=>m(u).period=e)},null,8,["modelValue","label","options","error"])]),l.period?(p(),U("div",_e,[n(Q,{name:"newBatch",label:s.$trans("global.select",{attribute:s.$trans("academic.batch.batch")}),modelValue:l.newBatch,"onUpdate:modelValue":a[9]||(a[9]=e=>l.newBatch=e),error:m(u).newBatch,"onUpdate:error":a[10]||(a[10]=e=>m(u).newBatch=e),"value-prop":"uuid","search-key":"course_batch","search-action":"academic/batch/list","additional-search-query":{period:l.period}},{selectedOption:t(e=>[d(r(e.value.course.name)+" "+r(e.value.name),1)]),listOption:t(e=>[d(r(e.option.course.nameWithTerm)+" "+r(e.option.name),1)]),_:1},8,["label","modelValue","error","additional-search-query"])])):V("",!0),g("div",he,[n(O,{modelValue:l.date,"onUpdate:modelValue":a[11]||(a[11]=e=>l.date=e),name:"date",label:s.$trans("student.promotion.props.date"),"no-clear":"",error:m(u).date,"onUpdate:error":a[12]||(a[12]=e=>m(u).date=e)},null,8,["modelValue","label","error"])]),g("div",ve,[n(H,{vertical:"",modelValue:l.assignFee,"onUpdate:modelValue":a[13]||(a[13]=e=>l.assignFee=e),name:"assignFee",label:s.$trans("global.assign",{attribute:s.$trans("student.fee.fee")}),error:m(u).assignFee,"onUpdate:error":a[14]||(a[14]=e=>m(u).assignFee=e)},null,8,["modelValue","label","error"]),n(X,null,{default:t(()=>[g("span",ke,r(s.$trans("student.promotion.promotion_assign_fee_tip")),1)]),_:1})])],64))])]),_:1},8,["form"])]),_:1},8,["is-loading"])]),_:1})):V("",!0)],64)}}});export{Be as default};
