import{u as P,k as Y,H as E,I as Z,m as x,q as ee,r as p,t as $,o as u,w as c,d as i,a as b,b as _,e as d,f as t,v as h,x as n,F as L,y as te,N as se,K as ae}from"./app-Cvm44xuh.js";const re={class:"grid grid-cols-4 gap-6"},oe={class:"col-span-4 sm:col-span-1"},ne={key:0,class:"col-span-2 sm:col-span-1"},le={key:1,class:"col-span-2 sm:col-span-1"},ie={class:"mt-4 grid grid-cols-3 gap-6"},ue={class:"col-span-2 sm:col-span-1"},ce={class:"col-span-2 sm:col-span-1"},de={class:"col-span-3 sm:col-span-1"},pe={class:"flex items-end justify-between space-x-4"},me={class:"flex-1"},be={key:0,class:"text-success text-sm"},ye={key:1,class:"text-danger text-sm"},_e={key:2,class:"text-danger text-sm"},ve={key:0,class:"dark:text-gray-400"},ge={class:"mt-4"},ke={class:"mt-4 grid grid-cols-3 gap-4"},fe={class:"col-span-3"},he={name:"LibraryTransactionForm"},Se=Object.assign(he,{setup(z){const D=P(),a=Y("$trans"),V={to:"",requester:"",issueDate:"",dueDate:"",records:[],remarks:""},B={uuid:E(),copy:{}},U="library/transaction/",l=Z(U),O=x({to:[]}),S=x({requester:"",isLoaded:!D.params.uuid}),r=x({...V}),v=x({currentStatus:null,currentStatusDetail:""}),I=o=>{Object.assign(O,o)},C=()=>{r.records.push({...B,uuid:E()})},K=async o=>{await se()&&(r.records.length==1?r.records=[B]:r.records.splice(o,1))},M=o=>{var s,k,y,g,f,q;((s=o.issueStatus)==null?void 0:s.value)=="available"?(v.currentStatus="available",v.currentStatusDetail=(k=o.issueStatus)==null?void 0:k.label):((y=o.issueStatus)==null?void 0:y.value)=="issued"?(v.currentStatus="issued",v.currentStatusDetail=a("library.transaction.issue_to",{attribute:((g=o.requester)==null?void 0:g.name)+" ("+o.issuedTo+")"})):((f=o.issueStatus)==null?void 0:f.value)=="hold"&&(v.currentStatus="hold",v.currentStatusDetail=(q=o.holdStatus)==null?void 0:q.label)},G=o=>{v.currentStatus=null,v.currentStatusDetail=""},J=o=>{var k,y,g,f;let s=[];o.records.forEach(q=>{s.push({...q})}),Object.assign(V,{...o,records:s,to:o.to.value,requester:((k=o.requester)==null?void 0:k.uuid)||"",issueDate:(y=o.issueDate)==null?void 0:y.value,dueDate:(g=o.dueDate)==null?void 0:g.value}),Object.assign(r,ae(V)),S.requester=(f=o.requester)==null?void 0:f.uuid,S.isLoaded=!0};return ee(async()=>{D.params.uuid||C()}),(o,s)=>{const k=p("BaseSelect"),y=p("BaseSelectSearch"),g=p("DatePicker"),f=p("BaseButton"),q=p("HelperText"),Q=p("BaseBadge"),W=p("BaseTextarea"),X=p("FormAction");return u(),$(X,{"pre-requisites":!0,onSetPreRequisites:I,"init-url":U,"init-form":V,form:r,"set-form":J,redirect:"LibraryTransaction"},{default:c(()=>[i("div",re,[i("div",oe,[d(k,{modelValue:r.to,"onUpdate:modelValue":s[0]||(s[0]=e=>r.to=e),name:"to",label:t(a)("library.transaction.props.to"),options:O.to,error:t(l).to,"onUpdate:error":s[1]||(s[1]=e=>t(l).to=e)},null,8,["modelValue","label","options","error"])]),r.to=="student"?(u(),b("div",ne,[S.isLoaded?(u(),$(y,{key:0,name:"requester",label:t(a)("student.student"),placeholder:t(a)("global.select",{attribute:t(a)("student.student")}),modelValue:r.requester,"onUpdate:modelValue":s[2]||(s[2]=e=>r.requester=e),error:t(l).requester,"onUpdate:error":s[3]||(s[3]=e=>t(l).requester=e),"value-prop":"uuid","init-search":S.requester,"search-key":"name","search-action":"student/summary"},{selectedOption:c(e=>[h(n(e.value.name)+" ("+n(e.value.courseName+" "+e.value.batchName)+") ",1)]),listOption:c(e=>[h(n(e.option.name)+" ("+n(e.option.courseName+" "+e.option.batchName)+") ",1)]),_:1},8,["label","placeholder","modelValue","error","init-search"])):_("",!0)])):_("",!0),r.to=="employee"?(u(),b("div",le,[S.isLoaded?(u(),$(y,{key:0,name:"requester",label:t(a)("employee.employee"),placeholder:t(a)("global.select",{attribute:t(a)("employee.employee")}),modelValue:r.requester,"onUpdate:modelValue":s[4]||(s[4]=e=>r.requester=e),error:t(l).requester,"onUpdate:error":s[5]||(s[5]=e=>t(l).requester=e),"value-prop":"uuid","init-search":S.requester,"search-key":"name","search-action":"employee/summary"},{selectedOption:c(e=>[h(n(e.value.name)+" ("+n(e.value.designation)+") ",1)]),listOption:c(e=>[h(n(e.option.name)+" ("+n(e.option.designation)+") ",1)]),_:1},8,["label","placeholder","modelValue","error","init-search"])):_("",!0)])):_("",!0)]),i("div",ie,[i("div",ue,[d(g,{modelValue:r.issueDate,"onUpdate:modelValue":s[6]||(s[6]=e=>r.issueDate=e),name:"issueDate",label:t(a)("library.transaction.props.issue_date"),"no-clear":"",error:t(l).issueDate,"onUpdate:error":s[7]||(s[7]=e=>t(l).issueDate=e)},null,8,["modelValue","label","error"])]),i("div",ce,[d(g,{modelValue:r.dueDate,"onUpdate:modelValue":s[8]||(s[8]=e=>r.dueDate=e),name:"dueDate",label:t(a)("library.transaction.props.due_date"),"no-clear":"",error:t(l).dueDate,"onUpdate:error":s[9]||(s[9]=e=>t(l).dueDate=e)},null,8,["modelValue","label","error"])])]),(u(!0),b(L,null,te(r.records,(e,T)=>{var N,R,j,w,F,H,A;return u(),b("div",{class:"mt-4 grid grid-cols-3 gap-4",key:e.uuid},[i("div",de,[i("div",pe,[i("div",null,[d(f,{size:"xs",design:"danger",onClick:m=>K(T)},{default:c(()=>s[12]||(s[12]=[i("i",{class:"fas fa-trash"},null,-1)])),_:2,__:[12]},1032,["onClick"])]),i("div",me,[d(y,{name:`records.${T}.copy`,label:t(a)("global.select",{attribute:t(a)("library.book.props.number")}),modelValue:e.copy,"onUpdate:modelValue":m=>e.copy=m,error:t(l)[`records.${T}.copy`],"onUpdate:error":m=>t(l)[`records.${T}.copy`]=m,"object-prop":!0,"search-action":"library/bookCopy/list","init-search":(N=e.copy)==null?void 0:N.number,"search-key":"number","init-search-key":"number","additional-search-query":{detail:!0},onSelected:M,onRemoved:G},{selectedOption:c(m=>[h(n(m.value.book.title)+" ("+n(m.value.number)+") ",1)]),listOption:c(m=>[h(n(m.option.book.title)+" ("+n(m.option.number)+") ",1)]),_:2},1032,["name","label","modelValue","onUpdate:modelValue","error","onUpdate:error","init-search"]),(R=e.copy)!=null&&R.uuid?(u(),b(L,{key:0},[((j=e.copy.issueStatus)==null?void 0:j.value)=="available"?(u(),b("span",be,n((w=e.copy.issueStatus)==null?void 0:w.label),1)):_("",!0),((F=e.copy.issueStatus)==null?void 0:F.value)=="issued"?(u(),b("span",ye,n(t(a)("library.transaction.issue_to",{attribute:((H=e.copy.requester)==null?void 0:H.name)+" ("+e.copy.issuedTo+")"})),1)):_("",!0),((A=e.copy.issueStatus)==null?void 0:A.value)=="hold"?(u(),b("span",_e,n(t(a)("library.transaction.statuses.hold")),1)):_("",!0),d(q,null,{default:c(()=>[e.copy.location?(u(),b("span",ve,n(t(a)("library.book_addition.props.location"))+" "+n(e.copy.location),1)):_("",!0)]),_:2},1024)],64)):_("",!0)])])])])}),128)),i("div",ge,[d(Q,{design:"primary",onClick:C,class:"cursor-pointer"},{default:c(()=>[h(n(t(a)("global.add",{attribute:t(a)("general.row")})),1)]),_:1})]),i("div",ke,[i("div",fe,[d(W,{rows:1,modelValue:r.remarks,"onUpdate:modelValue":s[10]||(s[10]=e=>r.remarks=e),name:"remarks",label:t(a)("library.transaction.props.remarks"),error:t(l).remarks,"onUpdate:error":s[11]||(s[11]=e=>t(l).remarks=e)},null,8,["modelValue","label","error"])])])]),_:1},8,["form"])}}}),qe={name:"LibraryTransactionAction"},Ve=Object.assign(qe,{setup(z){const D=P();return(a,V)=>{const B=p("PageHeaderAction"),U=p("PageHeader"),l=p("ParentTransition");return u(),b(L,null,[d(U,{title:a.$trans(t(D).meta.trans,{attribute:a.$trans(t(D).meta.label)}),navs:[{label:a.$trans("library.library"),path:"Library"},{label:a.$trans("library.transaction.transaction"),path:"LibraryTransactionList"}]},{default:c(()=>[d(B,{name:"LibraryTransaction",title:a.$trans("library.transaction.transaction"),actions:["list"]},null,8,["title"])]),_:1},8,["title","navs"]),d(l,{appear:"",visibility:!0},{default:c(()=>[d(Se)]),_:1})],64)}}});export{Ve as default};
