import{i as U,j as q,k as O,l as E,m as S,q as G,r as v,A as J,a as i,o as n,d as a,b as r,f as l,v as u,x as d,e as b,w as c,z as $,t as h,F as K,y as Q,B as x,n as W,$ as X}from"./app-Cvm44xuh.js";import{_ as Z}from"./Form-BUCFKQgb.js";import{_ as ee,u as te}from"./ShowImages-BG8SVuPv.js";import"./index-Dfe-y4c7.js";const se={class:"max-w-3xl mx-auto px-4 py-8 text-sm"},ae={class:"bg-white dark:bg-dark-header rounded-lg shadow-md"},ne={class:"p-6 border-b border-gray-200 dark:border-gray-700"},re={class:"flex items-center justify-between"},oe={class:"flex items-center gap-4"},ie=["src"],le={class:"dark:text-gray-300"},de={class:"text-xl font-semibold"},ue={class:"flex items-center gap-2 dark:text-gray-300"},ce={key:0,class:"p-6 border-b border-gray-200 dark:border-gray-700"},pe={class:"flex justify-center items-center p-6"},me={class:"text-center text-xs border border-gray-300 dark:border-gray-600 rounded-full px-4 py-2 cursor-pointer"},ge={class:"p-6"},fe={class:"flex items-center justify-between"},he=["onClick"],_e=["src"],ke={class:"ml-3 dark:text-gray-300"},ye={class:"font-semibold"},ve={class:"text-xs text-gray-500 dark:text-gray-400"},be={class:"ml-1"},xe={key:0},Ce={key:1},$e={key:2},we={class:"flex items-center gap-2"},Be={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},Le=["onClick"],Pe=["innerHTML"],Me={key:0},Ee=["onClick"],Se={key:0,class:"border-b border-gray-200 dark:border-gray-700"},De={key:1,class:"text-center py-4"},He={__name:"Index",setup(Te){const m=U(),C=q(),D=O("moment"),T=E("profile.name"),j=E("avatar"),p=S({data:[],meta:{}}),o=S({isLoading:!1,nextCursor:null,posts:[],images:[]}),f=async e=>{o.isLoading||(o.isLoading=!0,await C.dispatch("post/list",{params:{cursor:e}}).then(t=>{e?p.data=[...p.data,...t.data]:Object.assign(p,t),o.nextCursor=t.meta.nextCursor}).catch(t=>{console.error("Error loading posts:",t)}).finally(()=>{o.isLoading=!1}))},A=e=>{const{scrollTop:t,scrollHeight:_,clientHeight:w}=e.target;_-t-w<50&&o.nextCursor&&!o.isLoading&&f(o.nextCursor)},F=e=>te(new Date(e.replace(" ","T"))),z=e=>{p.data.unshift(e)},H=async e=>{await C.dispatch("post/pin",{uuid:e.uuid}).then(t=>{f()}).catch(t=>{console.error("Error pinning post:",t)})},N=async e=>{await C.dispatch("post/unpin",{uuid:e.uuid}).then(t=>{f()}).catch(t=>{console.error("Error unpinning post:",t)})},V=async e=>{await X()&&(o.isLoading=!0,await C.dispatch("post/delete",{uuid:e.uuid}).then(t=>{p.data=p.data.filter(_=>_.uuid!==e.uuid)}).catch(t=>{console.error("Error loading posts:",t)}).finally(()=>{o.isLoading=!1}))};return G(()=>{f()}),(e,t)=>{const _=v("BaseButton"),w=v("BaseLoader"),Y=v("BaseBadge"),k=v("FloatingMenuItem"),I=v("FloatingMenu"),y=J("tooltip");return n(),i("div",se,[a("div",ae,[a("div",ne,[a("div",re,[a("div",oe,[a("div",null,[a("img",{src:l(j),class:"w-12 h-12 rounded-full"},null,8,ie)]),a("div",le,[u(d(e.$trans("general.greeting_message",{name:l(T)}))+" ",1),a("h3",de,d(l(D)().format("dddd Do, MMMM YYYY")),1)])]),a("div",ue,[b(_,{size:"xs",onClick:t[0]||(t[0]=s=>l(m).push({name:"Dashboard"}))},{default:c(()=>[u(d(e.$trans("dashboard.dashboard")),1)]),_:1}),l($)("post:config")?(n(),i("span",{key:0,class:"cursor-pointer",onClick:t[1]||(t[1]=s=>l(m).push({name:"PostConfig"}))},t[3]||(t[3]=[a("i",{class:"fas fa-cog"},null,-1)]))):r("",!0)])])]),l($)("post:create")?(n(),i("div",ce,[b(Z,{onRefresh:f,onPostCreated:z})])):r("",!0),a("div",{onScroll:A},[o.isLoading?(n(),h(w,{key:0},{default:c(()=>[a("div",pe,[a("span",me,d(e.$trans("general.loading")),1)])]),_:1})):r("",!0),(n(!0),i(K,null,Q(p.data,(s,R)=>{var B,L,P,M;return n(),i("div",{key:s.uuid},[a("div",ge,[a("div",fe,[a("div",{class:"flex items-center mb-4 cursor-pointer",onClick:g=>l(m).push({name:"PostShow",params:{uuid:s.uuid}})},[(L=(B=s.user)==null?void 0:B.profile)!=null&&L.avatar?(n(),i("img",{key:0,class:"w-10 h-10 rounded-full",src:(M=(P=s.user)==null?void 0:P.profile)==null?void 0:M.avatar,alt:"User avatar"},null,8,_e)):r("",!0),a("div",ke,[a("h3",ye,[u(d(s.author.name)+" ",1),s.author.detail?(n(),h(Y,{key:0,size:"sm"},{default:c(()=>[u(d(s.author.detail),1)]),_:2},1024)):r("",!0)]),a("p",ve,[x((n(),i("span",null,[u(d(F(s.createdAt.at)),1)])),[[y,s.createdAt.formatted]]),a("span",be,[s.visibility.value=="public"?x((n(),i("span",xe,t[4]||(t[4]=[a("i",{class:"fas fa-globe-americas"},null,-1)]))),[[y,e.$trans("post.visibilities.public")]]):r("",!0),s.visibility.value=="authenticated"?x((n(),i("span",Ce,t[5]||(t[5]=[a("i",{class:"fas fa-users"},null,-1)]))),[[y,e.$trans("post.visibilities.authenticated")]]):r("",!0),s.visibility.value=="private"?x((n(),i("span",$e,t[6]||(t[6]=[a("i",{class:"fas fa-lock"},null,-1)]))),[[y,e.$trans("post.visibilities.private")]]):r("",!0)])])])],8,he),a("div",we,[s.isPinned?x((n(),i("span",Be,t[7]||(t[7]=[a("i",{class:"fas fa-lg fa-thumbtack"},null,-1)]))),[[y,e.$trans("global.pinned",{attribute:e.$trans("post.post")})]]):r("",!0),b(I,null,{default:c(()=>[b(k,{icon:"fas fa-arrow-circle-right",onClick:g=>l(m).push({name:"PostShow",params:{uuid:s.uuid}})},{default:c(()=>[u(d(e.$trans("general.show")),1)]),_:2},1032,["onClick"]),s.isPinned?r("",!0):(n(),h(k,{key:0,icon:"fas fa-thumbtack",onClick:g=>H(s)},{default:c(()=>[u(d(e.$trans("global.pin",{attribute:e.$trans("post.post")})),1)]),_:2},1032,["onClick"])),s.isPinned?(n(),h(k,{key:1,icon:"fas fa-thumbtack-slash",onClick:g=>N(s)},{default:c(()=>[u(d(e.$trans("global.unpin",{attribute:e.$trans("post.post")})),1)]),_:2},1032,["onClick"])):r("",!0),s.isEditable&&l($)("post:edit")?(n(),h(k,{key:2,icon:"fas fa-edit",onClick:g=>l(m).push({name:"PostEdit",params:{uuid:s.uuid}})},{default:c(()=>[u(d(e.$trans("general.edit")),1)]),_:2},1032,["onClick"])):r("",!0),s.isEditable&&l($)("post:delete")?(n(),h(k,{key:3,icon:"fas fa-trash",onClick:g=>V(s)},{default:c(()=>[u(d(e.$trans("general.delete")),1)]),_:2},1032,["onClick"])):r("",!0)]),_:2},1024)])]),a("div",{class:"w-full",onClick:g=>l(m).push({name:"PostShow",params:{uuid:s.uuid}})},[a("div",{class:"md-content text-gray-800 dark:text-gray-400 cursor-pointer",innerHTML:s.content},null,8,Pe),s.hasMore?(n(),i("div",Me,[a("span",{class:"text-xs font-semibold text-gray-700 dark:text-gray-400 cursor-pointer",onClick:g=>l(m).push({name:"PostShow",params:{uuid:s.uuid}})},d(e.$trans("general.show_more")),9,Ee)])):r("",!0)],8,Le),b(ee,{post:s},null,8,["post"])]),R<p.data.length-1?(n(),i("div",Se)):r("",!0)])}),128)),o.nextCursor&&!o.isLoading?(n(),i("div",De,[a("span",{class:"text-xs border border-gray-300 dark:border-gray-600 dark:text-gray-400 rounded-full px-4 py-2 cursor-pointer",onClick:t[2]||(t[2]=s=>f(o.nextCursor))},[a("i",{class:W(["fas fa-spinner mr-2",{"animate-spin":o.isLoading}])},null,2),u(" "+d(e.$trans("general.show_more")),1)])])):r("",!0)],32)])])}}};export{He as default};
