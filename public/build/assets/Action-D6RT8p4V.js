import{u as Q,k as Y,m as I,I as Z,q as x,r as y,t as C,o as i,w as l,d as o,b as D,f as u,v as H,x as n,e as r,i as re,j as se,c as U,p as X,a as g,F as B,y as A,H as ie,K as ue}from"./app-Cvm44xuh.js";import{a as j,f as R}from"./currency-B2avElsq.js";const de={class:"grid grid-cols-3 gap-6"},me={class:"col-span-3 sm:col-span-1"},pe={class:"col-span-3 sm:col-span-1"},ce={class:"mt-4 grid grid-cols-3 gap-6"},ye={class:"col-span-3 sm:col-span-1"},fe={__name:"FilterGenerate",props:{initUrl:{type:String,default:""}},emits:["hide"],setup(G,{emit:b}){const h=Q();Y("moment");const L=b,q=G,V={employee:"",startDate:"",endDate:"",ignoreAttendance:!1},c=I({...V}),p=Z(q.initUrl),F=I({employee:"",isLoaded:!h.query.employee});return x(async()=>{F.employee=h.query.employee,F.isLoaded=!0}),(w,m)=>{const K=y("BaseSelectSearch"),M=y("DatePicker"),z=y("BaseSwitch"),J=y("FilterForm");return i(),C(J,{"init-form":V,form:c,onHide:m[7]||(m[7]=s=>L("hide"))},{default:l(()=>[o("div",de,[o("div",me,[F.isLoaded?(i(),C(K,{key:0,name:"employee",label:w.$trans("global.select",{attribute:w.$trans("employee.employee")}),modelValue:c.employee,"onUpdate:modelValue":m[0]||(m[0]=s=>c.employee=s),"value-prop":"uuid","init-search":F.employee,"additional-search-query":{self:0,type:"all"},"search-action":"employee/list",error:u(p).employee,"onUpdate:error":m[1]||(m[1]=s=>u(p).employee=s)},{selectedOption:l(s=>[H(n(s.value.name)+" ("+n(s.value.codeNumber)+") ",1)]),listOption:l(s=>[H(n(s.option.name)+" ("+n(s.option.codeNumber)+") ",1)]),_:1},8,["label","modelValue","init-search","error"])):D("",!0)]),o("div",pe,[r(M,{start:c.startDate,"onUpdate:start":m[2]||(m[2]=s=>c.startDate=s),end:c.endDate,"onUpdate:end":m[3]||(m[3]=s=>c.endDate=s),name:"dateBetween",as:"range",label:w.$trans("employee.payroll.props.period"),error:u(p).startDate,"onUpdate:error":m[4]||(m[4]=s=>u(p).startDate=s)},null,8,["start","end","label","error"])])]),o("div",ce,[o("div",ye,[r(z,{vertical:"",modelValue:c.ignoreAttendance,"onUpdate:modelValue":m[5]||(m[5]=s=>c.ignoreAttendance=s),name:"ignoreAttendance",label:w.$trans("employee.payroll.props.ignore_attendance"),error:u(p).ignoreAttendance,"onUpdate:error":m[6]||(m[6]=s=>u(p).ignoreAttendance=s)},null,8,["modelValue","label","error"])])])]),_:1},8,["form"])}}},_e={class:"font-semibold"},ge={class:"space-y-4"},be={class:"grid grid-cols-2 gap-4"},ve={class:"col-span-2 space-y-4 sm:col-span-1"},He={key:0},$e={class:"col-span-2 space-y-4 sm:col-span-1"},he={key:0},Ve={key:0},De={class:"col-span-2 sm:col-span-1"},Ue={class:"text-success flex justify-between text-lg font-semibold"},ke={class:"col-span-2 sm:col-span-1"},Ee={class:"text-danger flex justify-between text-lg font-semibold"},Se={class:"col-span-2 sm:col-span-1"},Be={class:"text-success flex justify-between text-xl font-semibold"},Ce={class:"mt-4 grid grid-cols-2 gap-4"},Fe={class:"col-span-2 space-y-4 sm:col-span-1"},we={key:0},Te={class:"text-success flex justify-between text-lg font-semibold"},je={class:"mt-4 grid grid-cols-2 gap-3"},qe={class:"col-span-3"},Ae={name:"EmployeePayrollForm"},Le=Object.assign(Ae,{setup(G){const b=Q(),h=re(),L=se(),q=Y("emitter"),V={records:[],remarks:""},c="employee/payroll/",p=Z(c),F=U(()=>v.records.filter(e=>e.payHead.category==="earning")),w=U(()=>v.records.filter(e=>e.payHead.category==="deduction")),m=U(()=>v.records.filter(e=>e.payHead.category==="employee_contribution")),K=U(()=>v.records.filter(e=>e.payHead.category==="employer_contribution")),M=U(()=>{let e=0;return v.records.filter(a=>a.payHead.category=="earning").filter(a=>!a.payHead.asTotal).forEach(a=>{e+=j(a.amount)}),R(e)}),z=U(()=>{let e=0;return v.records.filter(a=>a.payHead.category=="deduction").filter(a=>!a.payHead.asTotal).forEach(a=>{e+=j(a.amount)}),v.records.filter(a=>a.payHead.category=="employee_contribution").forEach(a=>{e+=j(a.amount)}),R(e)}),J=U(()=>{let e=0;return v.records.filter(a=>!a.payHead.asTotal).forEach(a=>{a.payHead.category=="earning"?e+=j(a.amount):(a.payHead.category=="deduction"||a.payHead.category=="employee_contribution")&&(e-=j(a.amount))}),R(e)}),s=U(()=>{let e=0;return v.records.filter(a=>a.payHead.category=="employer_contribution").forEach(a=>{e+=j(a.amount)}),R(e)}),P=X(!1),k=X(!1),$=I({}),v=I({...V}),W=async()=>{k.value=!1,P.value=!0,await L.dispatch(c+"fetchDetail",{params:b.query}).then(e=>{var a,E,d,S,T;Object.assign($,{attendanceSummary:e.attendanceSummary,netEarning:(a=e.netEarning)==null?void 0:a.value,netDeduction:(E=e.netDeduction)==null?void 0:E.value,netEmployeeContribution:(d=e.employeeContribution)==null?void 0:d.value,netEmployerContribution:(S=e.employerContribution)==null?void 0:S.value,netSalary:(T=e.netSalary)==null?void 0:T.value,workingDays:e.workingDays}),Object.assign(v,{records:e.records}),P.value=!1,k.value=!0}).catch(e=>{P.value=!1})},ee=e=>{var E;Object.assign($,{codeNumber:e.codeNumber,employee:e.employee,period:e.period,attendanceSummary:e.attendanceSummary,netEarning:e.netEarning.value,netDeduction:e.netDeduction.value,netSalary:e.netSalary.value});let a=e.records.map(d=>{let S={uuid:d.payHead.uuid||ie(),name:d.payHead.name,category:d.payHead.category.value,code:d.payHead.code,asTotal:d.payHead.asTotal,visibility:d.payHead.visibility};return{uuid:d.uuid,payHead:S,amount:d.amount.value}});Object.assign(V,{records:a,remarks:e.remarks}),Object.assign(v,ue(V)),h.push({name:b.name,query:{employee:(E=e.employee)==null?void 0:E.uuid,startDate:e.startDate.value,endDate:e.endDate.value}})},ae=()=>{k.value=!1},te=()=>{k.value=!1,q.emit("resetFilter")};return x(async()=>{if(b.params.uuid){k.value=!0;return}b.query.employee&&b.query.startDate&&b.query.endDate&&await W()}),(e,a)=>{const E=y("ParentTransition"),d=y("ListItemView"),S=y("ListContainerVertical"),T=y("BaseCard"),N=y("BaseLabel"),O=y("BaseInput"),oe=y("BaseTextarea"),ne=y("FormAction"),le=y("DetailLayoutVertical");return i(),g(B,null,[r(E,{appear:"",visibility:!0},{default:l(()=>[u(b).params.uuid?D("",!0):(i(),C(fe,{key:0,onAfterFilter:W,"init-url":c}))]),_:1}),k.value?(i(),C(le,{key:0},{detail:l(()=>[u(b).params.uuid&&$.codeNumber?(i(),C(T,{key:0,"no-padding":"","no-content-padding":""},{title:l(()=>[H(n(e.$trans("employee.payroll.props.code_number"))+" "+n($.codeNumber),1)]),default:l(()=>[r(S,null,{default:l(()=>[r(d,{label:e.$trans("employee.employee")},{default:l(()=>[H(n($.employee.name),1)]),_:1},8,["label"]),r(d,{label:e.$trans("employee.department.department")},{default:l(()=>[H(n($.employee.department),1)]),_:1},8,["label"]),r(d,{label:e.$trans("employee.designation.designation")},{default:l(()=>[H(n($.employee.designation),1)]),_:1},8,["label"]),r(d,{label:e.$trans("employee.employment_status.employment_status")},{default:l(()=>[H(n($.employee.employmentStatus),1)]),_:1},8,["label"]),r(d,{label:e.$trans("employee.payroll.props.period")},{default:l(()=>[o("span",_e,n($.period),1)]),_:1},8,["label"])]),_:1})]),_:1})):D("",!0),r(T,{"no-padding":"","no-content-padding":""},{title:l(()=>[H(n(e.$trans("global.summary",{attribute:e.$trans("attendance.attendance")})),1)]),default:l(()=>[r(S,null,{default:l(()=>[(i(!0),g(B,null,A($.attendanceSummary,t=>(i(),C(d,{align:"right",label:t.name+" ("+t.code+")"},{default:l(()=>[H(n(t.count)+" "+n(e.$trans("list.durations."+t.unit)),1)]),_:2},1032,["label"]))),256)),r(d,{align:"right",label:e.$trans("employee.attendance.payable_days"),class:"font-semibold text-success"},{default:l(()=>[H(n($.workingDays)+" "+n(e.$trans("list.durations.days")),1)]),_:1},8,["label"])]),_:1})]),_:1})]),default:l(()=>[o("div",ge,[k.value?(i(),C(T,{key:0,"is-loading":P.value},{default:l(()=>[r(ne,{"no-card":"","init-url":c,action:u(b).params.uuid?"edit":"generate","init-form":V,form:v,"set-form":ee,"after-reset":ae,redirect:"EmployeePayroll",onCompleted:te},{default:l(()=>[o("div",be,[o("div",ve,[(i(!0),g(B,null,A(F.value.filter(t=>t.payHead.visibility),(t,f)=>(i(),g("div",null,[r(N,{class:"text-success"},{default:l(()=>[H(n(t.payHead.name)+" ("+n(t.payHead.code)+") ",1),t.payHead.asTotal?(i(),g("span",He,a[2]||(a[2]=[o("i",{class:"fas fa-not-equal"},null,-1)]))):D("",!0)]),_:2},1024),r(O,{currency:"",modelValue:t.amount,"onUpdate:modelValue":_=>t.amount=_,name:`records.${f}.amount`,placeholder:t.payHead.name,error:u(p)[`records.${f}.amount`],"onUpdate:error":_=>u(p)[`records.${f}.amount`]=_},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))),256))]),o("div",$e,[(i(!0),g(B,null,A(w.value.filter(t=>t.payHead.visibility),(t,f)=>(i(),g("div",null,[r(N,{class:"text-danger"},{default:l(()=>[H(n(t.payHead.name)+" ("+n(t.payHead.code)+") ",1),t.payHead.asTotal?(i(),g("span",he,a[3]||(a[3]=[o("i",{class:"fas fa-not-equal"},null,-1)]))):D("",!0)]),_:2},1024),r(O,{currency:"",modelValue:t.amount,"onUpdate:modelValue":_=>t.amount=_,name:`records.${f}.amount`,placeholder:t.payHead.name,error:u(p)[`records.${f}.amount`],"onUpdate:error":_=>u(p)[`records.${f}.amount`]=_},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))),256)),(i(!0),g(B,null,A(m.value.filter(t=>t.payHead.visibility),(t,f)=>(i(),g("div",null,[r(N,{class:"text-danger"},{default:l(()=>[H(n(t.payHead.name)+" ("+n(t.payHead.code)+") ",1),t.payHead.asTotal?(i(),g("span",Ve,a[4]||(a[4]=[o("i",{class:"fas fa-not-equal"},null,-1)]))):D("",!0)]),_:2},1024),r(O,{currency:"",modelValue:t.amount,"onUpdate:modelValue":_=>t.amount=_,name:`records.${f}.amount`,placeholder:t.payHead.name,error:u(p)[`records.${f}.amount`],"onUpdate:error":_=>u(p)[`records.${f}.amount`]=_},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))),256))]),o("div",De,[o("div",Ue,[o("span",null,n(e.$trans("employee.payroll.salary_structure.props.net_earning")),1),o("span",null,n(M.value),1)])]),o("div",ke,[o("div",Ee,[o("span",null,n(e.$trans("employee.payroll.salary_structure.props.net_deduction")),1),o("span",null,n(z.value),1)])]),o("div",Se,[o("div",Be,[o("span",null,n(e.$trans("employee.payroll.salary_structure.props.net_salary")),1),o("span",null,n(J.value),1)])])]),a[6]||(a[6]=o("hr",{class:"my-4"},null,-1)),o("div",Ce,[o("div",Fe,[(i(!0),g(B,null,A(K.value,(t,f)=>(i(),g("div",null,[r(N,{class:"text-success"},{default:l(()=>[H(n(t.payHead.name)+" ("+n(t.payHead.code)+") ",1),t.payHead.asTotal?(i(),g("span",we,a[5]||(a[5]=[o("i",{class:"fas fa-not-equal"},null,-1)]))):D("",!0)]),_:2},1024),r(O,{currency:"",modelValue:t.amount,"onUpdate:modelValue":_=>t.amount=_,name:`records.${f}.amount`,placeholder:t.payHead.name,error:u(p)[`records.${f}.amount`],"onUpdate:error":_=>u(p)[`records.${f}.amount`]=_},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))),256)),o("div",Te,[o("span",null,n(e.$trans("employee.payroll.salary_structure.props.net_employer_contribution")),1),o("span",null,n(s.value),1)])])]),o("div",je,[o("div",qe,[r(oe,{modelValue:v.remarks,"onUpdate:modelValue":a[0]||(a[0]=t=>v.remarks=t),name:"remarks",label:e.$trans("employee.payroll.props.remarks"),error:u(p).remarks,"onUpdate:error":a[1]||(a[1]=t=>u(p).remarks=t)},null,8,["modelValue","label","error"])])])]),_:1,__:[6]},8,["action","form"])]),_:1},8,["is-loading"])):D("",!0)])]),_:1})):D("",!0)],64)}}}),Pe={name:"EmployeePayrollAction"},Re=Object.assign(Pe,{setup(G){const b=Q();return(h,L)=>{const q=y("PageHeaderAction"),V=y("PageHeader"),c=y("ParentTransition");return i(),g(B,null,[r(V,{title:h.$trans(u(b).meta.trans,{attribute:h.$trans(u(b).meta.label)}),navs:[{label:h.$trans("employee.employee"),path:"Employee"},{label:h.$trans("employee.payroll.payroll"),path:"EmployeePayroll"}]},{default:l(()=>[r(q,{name:"EmployeePayroll",title:h.$trans("employee.payroll.payroll"),actions:["list"]},null,8,["title"])]),_:1},8,["title","navs"]),r(c,{appear:"",visibility:!0},{default:l(()=>[r(Le)]),_:1})],64)}}});export{Re as default};
