import{u as G,i as H,j as J,k as Q,I as W,m as v,p as V,r as g,a as l,o as r,e as b,w as _,b as m,d as s,f as n,F as x,y as X,x as h,Y as Z,t as B,v as k,$ as ee,a0 as D,K as P,a1 as te}from"./app-Cvm44xuh.js";const se={class:"space-y-4"},oe={key:0,class:"mt-4 mb-4 flex items-center flex-wrap gap-2"},ae=["src"],re={key:0,class:"absolute bottom-2 right-2 flex items-center justify-center",style:{width:"36px",height:"36px"}},ie={class:"bg-black bg-opacity-60 rounded-full p-1 flex items-center justify-center"},ne={viewBox:"0 0 36 36",class:"circular-chart",style:{width:"28px",height:"28px"}},le=["stroke-dasharray"],ce={x:"18",y:"22",class:"percentage","text-anchor":"middle",fill:"#fff","font-size":"10"},ue={key:1,class:"absolute bottom-2 right-2 flex items-center justify-center",style:{width:"36px",height:"36px"}},pe=["onClick"],de={key:2,class:"absolute bottom-2 right-2 bg-black bg-opacity-60 rounded px-2 py-1 text-xs text-red-400"},me={class:"mt-2 flex items-center justify-between"},fe={class:"flex space-x-2"},ge={class:"flex items-center gap-2"},he={name:"PostForm"},_e=Object.assign(he,{emits:["refresh","postCreated"],setup(be,{emit:O}){const f=G(),w=H();J();const u=Q("$trans"),S=O,p={content:"",images:[],visibility:"public"},j="post/",R=W(j),$=v({}),o=v({...p}),c=v({images:[]}),E=V(null),I=V(!1),M=[{value:"public",label:u("post.visibilities.public"),icon:"fas fa-globe-americas"},{value:"authenticated",label:u("post.visibilities.authenticated"),icon:"fas fa-user-friends"}],U=e=>{Object.assign($,e)},L=e=>{Object.assign(p,{...e,visibility:e.visibility.value,content:e.contentOriginal,images:e.images.map(t=>({url:t.path}))}),Object.assign(o,P(p)),c.images=e.images.map(t=>({url:t.path,preview:t.url,status:"uploaded",progress:100,msg:""}))},q=e=>{o.content+=` ${e}`},A=e=>{p.images=[],c.images=[],Object.assign(o,P(p)),f.params.uuid?w.push({name:"PostList"}):S("postCreated",e.post)},N=()=>{E.value.click()},T=e=>{Array.from(e.target.files).forEach(i=>{const d=new FileReader;d.onload=y=>{c.images.push({file:i,preview:y.target.result,progress:0,status:"waiting",url:null,msg:""}),K()},d.readAsDataURL(i)}),e.target.value=""},z=async e=>{if(await ee()){if(f.params.uuid){c.images.splice(e,1),o.images.splice(e,1);return}D({url:`/app/post/images?image=${c.images[e].url}`,method:"DELETE"}).then(()=>{c.images.splice(e,1),o.images.splice(e,1)}).catch(t=>{console.log(t)})}},K=async()=>{c.images.forEach(e=>{if(console.log(e),e.status==="waiting"){e.status="uploading";let t=new FormData;t.append("file",e.file),D({url:"/app/post/images",method:"POST",data:t,upload:!0,onUploadProgress:i=>{e.progress=Math.round(i.loaded*100/i.total)}}).then(i=>{e.status="uploaded",e.url=i.image,e.progress=100,o.images.push({url:e.url})}).catch(i=>{let d=te(i);e.status="error",e.msg=d.message,e.progress=0})}})};return(e,t)=>{const i=g("MintEditor"),d=g("CustomDropdown"),y=g("EmojiPicker"),C=g("BaseButton"),Y=g("FormAction");return r(),l("div",se,[b(Y,{"no-card":"","no-action-button":!0,"pre-requisites":!1,onSetPreRequisites:U,"init-url":j,"init-form":p,action:n(f).params.uuid?"update":"create",form:o,"set-form":L,afterSubmit:A},{default:_(()=>[b(i,{modelValue:o.content,"onUpdate:modelValue":t[0]||(t[0]=a=>o.content=a),placeholder:n(u)("post.share_placeholder"),rows:3,error:n(R).content},null,8,["modelValue","placeholder","error"]),c.images.length?(r(),l("div",oe,[(r(!0),l(x,null,X(c.images,(a,F)=>(r(),l("div",{key:F,class:"relative"},[s("img",{src:a.preview,class:"w-32 h-32 object-cover rounded"},null,8,ae),a.status==="uploading"?(r(),l("div",re,[s("div",ie,[(r(),l("svg",ne,[t[3]||(t[3]=s("path",{class:"circle-bg",d:`M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831`,fill:"none",stroke:"#eee","stroke-width":"3"},null,-1)),s("path",{class:"circle",d:`M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831`,fill:"none",stroke:"#3490dc","stroke-width":"3","stroke-dasharray":a.progress+", 100"},null,8,le),s("text",ce,h(a.progress)+"% ",1)]))])])):m("",!0),a.status==="uploaded"?(r(),l("div",ue,[s("button",{onClick:Z(ye=>z(F),["prevent"]),class:"bg-black bg-opacity-60 rounded-full shadow p-2 text-white text-xs flex items-center justify-center",style:{width:"28px",height:"28px"}},t[4]||(t[4]=[s("i",{class:"fas fa-trash"},null,-1)]),8,pe)])):m("",!0),a.status==="error"?(r(),l("div",de,h(a.msg||"Error"),1)):m("",!0)]))),128))])):m("",!0),s("div",me,[s("div",fe,[b(d,{modelValue:o.visibility,"onUpdate:modelValue":t[1]||(t[1]=a=>o.visibility=a),options:M,placeholder:n(u)("post.props.visibility")},null,8,["modelValue","placeholder"]),b(y,{onEmojiSelected:q}),s("button",{class:"flex items-center text-gray-600 hover:text-gray-800 dark:text-gray-300 dark:hover:text-gray-100 border border-gray-300 rounded-md p-2",type:"button",onClick:N},t[5]||(t[5]=[s("i",{class:"fa-regular fa-image"},null,-1)])),s("input",{ref_key:"fileInput",ref:E,type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:T},null,544)]),s("div",ge,[n(f).params.uuid?(r(),B(C,{key:0,design:"danger",onClick:t[2]||(t[2]=a=>n(w).push({name:"PostList"}))},{default:_(()=>[k(h(n(u)("general.cancel")),1)]),_:1})):m("",!0),o.content?(r(),B(C,{key:1,type:"submit",disabled:I.value},{default:_(()=>[n(f).params.uuid?(r(),l(x,{key:0},[t[6]||(t[6]=s("i",{class:"fas fa-pencil-alt mr-2"},null,-1)),k(" "+h(n(u)("global.update",{attribute:n(u)("post.post")})),1)],64)):(r(),l(x,{key:1},[t[7]||(t[7]=s("i",{class:"fas fa-paper-plane mr-2"},null,-1)),k(" "+h(n(u)("post.post")),1)],64))]),_:1},8,["disabled"])):m("",!0)])])]),_:1},8,["action","form"])])}}});export{_e as _};
