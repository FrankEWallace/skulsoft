import{u as z,k as Z,m as M,I as x,q as E,r as i,t as y,o as m,w as e,d as b,e as t,b as v,v as r,x as l,i as ee,j as te,z as ae,p as L,a as w,f as N,F as T,y as I}from"./app-Cvm44xuh.js";const ne={class:"grid grid-cols-3 gap-6"},se={class:"col-span-3 sm:col-span-1"},le={class:"col-span-3 sm:col-span-1"},oe={class:"col-span-3 sm:col-span-1"},re={class:"col-span-3 sm:col-span-1"},de={class:"col-span-3 sm:col-span-1"},ue={class:"col-span-3 sm:col-span-1"},ie={class:"col-span-3 sm:col-span-1"},me={class:"col-span-3 sm:col-span-1"},pe={class:"col-span-3 sm:col-span-1"},ce={class:"col-span-3 sm:col-span-1"},fe={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default(){return{}}}},emits:["hide"],setup(R,{emit:g}){const _=z();Z("moment");const B=g,U=R,F={codeNumber:"",voucherNumber:"",pgAccount:"",name:"",batches:[],startDate:"",endDate:"",period:"",ledgers:[],paymentMethods:[],status:""},o=M({...F});x(U.initUrl);const p=M({isLoaded:!_.query.batches}),h=M({paymentMethods:U.preRequisites.paymentMethods});return E(async()=>{p.batches=_.query.batches?_.query.batches.split(","):[],p.ledgers=_.query.ledgers?_.query.ledgers.split(","):[],p.paymentMethods=_.query.paymentMethods?_.query.paymentMethods.split(","):[],p.isLoaded=!0}),(u,n)=>{const $=i("BaseInput"),V=i("BaseSelectSearch"),A=i("DatePicker"),q=i("BaseSelect"),d=i("FilterForm");return m(),y(d,{"init-form":F,multiple:["batches","ledgers","paymentMethods"],form:o,onHide:n[11]||(n[11]=a=>B("hide"))},{default:e(()=>[b("div",ne,[b("div",se,[t($,{type:"text",modelValue:o.codeNumber,"onUpdate:modelValue":n[0]||(n[0]=a=>o.codeNumber=a),name:"codeNumber",label:u.$trans("student.admission.props.code_number")},null,8,["modelValue","label"])]),b("div",le,[t($,{type:"text",modelValue:o.voucherNumber,"onUpdate:modelValue":n[1]||(n[1]=a=>o.voucherNumber=a),name:"voucherNumber",label:u.$trans("finance.transaction.props.code_number")},null,8,["modelValue","label"])]),b("div",oe,[t($,{type:"text",modelValue:o.name,"onUpdate:modelValue":n[2]||(n[2]=a=>o.name=a),name:"name",label:u.$trans("contact.props.name")},null,8,["modelValue","label"])]),b("div",re,[p.isLoaded?(m(),y(V,{key:0,multiple:"",name:"batches",label:u.$trans("global.select",{attribute:u.$trans("academic.batch.batch")}),modelValue:o.batches,"onUpdate:modelValue":n[3]||(n[3]=a=>o.batches=a),"value-prop":"uuid","init-search":p.batches,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:e(a=>[r(l(a.value.course.name)+" "+l(a.value.name),1)]),listOption:e(a=>[r(l(a.option.course.nameWithTerm)+" "+l(a.option.name),1)]),_:1},8,["label","modelValue","init-search"])):v("",!0)]),b("div",de,[t(A,{start:o.startDate,"onUpdate:start":n[4]||(n[4]=a=>o.startDate=a),end:o.endDate,"onUpdate:end":n[5]||(n[5]=a=>o.endDate=a),name:"dateBetween",as:"range",label:u.$trans("general.date_between")},null,8,["start","end","label"])]),b("div",ue,[t(q,{name:"period",label:u.$trans("global.select",{attribute:u.$trans("academic.period.period")}),modelValue:o.period,"onUpdate:modelValue":n[6]||(n[6]=a=>o.period=a),"label-prop":"name","value-prop":"uuid",options:R.preRequisites.periods},null,8,["label","modelValue","options"])]),b("div",ie,[p.isLoaded?(m(),y(V,{key:0,multiple:"",name:"ledgers",label:u.$trans("global.select",{attribute:u.$trans("finance.ledger.ledger")}),modelValue:o.ledgers,"onUpdate:modelValue":n[7]||(n[7]=a=>o.ledgers=a),"label-props":"name","value-prop":"uuid","init-search":p.ledgers,"search-action":"finance/ledger/list"},null,8,["label","modelValue","init-search"])):v("",!0)]),b("div",me,[t(q,{multiple:"",modelValue:o.paymentMethods,"onUpdate:modelValue":n[8]||(n[8]=a=>o.paymentMethods=a),name:"paymentMethods",label:u.$trans("finance.payment_method.payment_method"),"label-prop":"name","value-prop":"uuid",options:h.paymentMethods},null,8,["modelValue","label","options"])]),b("div",pe,[t(q,{name:"status",label:u.$trans("global.select",{attribute:u.$trans("finance.transaction.props.status")}),modelValue:o.status,"onUpdate:modelValue":n[9]||(n[9]=a=>o.status=a),options:R.preRequisites.statuses},null,8,["label","modelValue","options"])]),b("div",ce,[t($,{type:"text",modelValue:o.pgAccount,"onUpdate:modelValue":n[10]||(n[10]=a=>o.pgAccount=a),name:"pgAccount",label:u.$trans("finance.config.props.pg_account")},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},be={name:"FinanceReportFeePayment"},ge=Object.assign(be,{setup(R){const g=z(),_=ee(),B=te();let U=["filter"],F=[];ae("finance:export")&&(F=["print","pdf","excel"]);const o="finance/report/",p=L(!1),h=L(!1),u=M({periods:[],ledgers:[],paymentMethods:[]}),n=M({headers:[],data:[],meta:{total:0}}),$=async()=>{h.value=!0,await B.dispatch(o+"preRequisite",{name:"fee-payment",params:g.query}).then(d=>{h.value=!1,Object.assign(u,d)}).catch(d=>{h.value=!1})},V=async()=>{h.value=!0,await B.dispatch(o+"fetchReport",{name:"fee-payment",params:g.query}).then(d=>{h.value=!1,Object.assign(n,d)}).catch(d=>{h.value=!1})},A=()=>{window.open(`/app/finance/reports/detailed-fee-payment/export?start_date=${g.query.startDate}&end_date=${g.query.endDate}`)},q=d=>{window.open(`/app/students/${d.studentUuid}/transactions/${d.uuid}/export?action=print`)};return E(async()=>{await $(),await V()}),(d,a)=>{const W=i("DropdownItem"),G=i("PageHeaderAction"),J=i("PageHeader"),P=i("ParentTransition"),k=i("TextMuted"),C=i("BaseBadge"),c=i("DataCell"),j=i("FloatingMenuItem"),K=i("FloatingMenu"),Q=i("DataRow"),X=i("DataTable"),Y=i("BaseCard");return m(),w(T,null,[t(J,{title:d.$trans(N(g).meta.label),navs:[{label:d.$trans("finance.finance"),path:"Finance"},{label:d.$trans("finance.report.report"),path:"FinanceReport"}]},{default:e(()=>[t(G,{url:"finance/reports/fee-payment/",name:"FinanceReportFeePayment",title:d.$trans("finance.report.fee_payment.fee_payment"),actions:N(U),"dropdown-actions":N(F),headers:n.headers,onToggleFilter:a[0]||(a[0]=s=>p.value=!p.value)},{dropdown:e(()=>[N(g).query.startDate&&N(g).query.endDate?(m(),y(W,{key:0,icon:"fas fa-file-excel",onClick:A},{default:e(()=>[r(l(d.$trans("finance.report.detailed_fee_payment")),1)]),_:1})):v("",!0)]),_:1},8,["title","actions","dropdown-actions","headers"])]),_:1},8,["title","navs"]),t(P,{appear:"",visibility:p.value},{default:e(()=>[t(fe,{onAfterFilter:V,"init-url":o,"pre-requisites":u,onHide:a[1]||(a[1]=s=>p.value=!1)},null,8,["pre-requisites"])]),_:1},8,["visibility"]),t(P,{appear:"",visibility:!0},{default:e(()=>[t(Y,{"no-padding":"","no-content-padding":"","is-loading":h.value},{default:e(()=>[t(X,{header:n.headers,footer:n.footers,meta:n.meta,module:"finance.report.fee_payment",onRefresh:V},{default:e(()=>[(m(!0),w(T,null,I(n.data,s=>(m(),y(Q,{key:s.uuid},{default:e(()=>[t(c,{name:"voucherNumber"},{default:e(()=>[r(l(s.voucherNumber)+" ",1),s.isOnline?(m(),y(k,{key:0,block:""},{default:e(()=>[r(l(s.referenceNumber),1)]),_:2},1024)):v("",!0),s.isRejected?(m(),y(C,{key:1,design:"warning",size:"sm"},{default:e(()=>[r(l(d.$trans("general.rejected")),1)]),_:1})):v("",!0),s.isCancelled?(m(),y(C,{key:2,design:"danger",size:"sm"},{default:e(()=>[r(l(d.$trans("general.cancelled")),1)]),_:1})):v("",!0),s.isOnline&&!s.isCompleted?(m(),y(C,{key:3,design:"danger",size:"sm"},{default:e(()=>[r(l(d.$trans("general.failed")),1)]),_:1})):v("",!0)]),_:2},1024),t(c,{name:"name"},{default:e(()=>[r(l(s.name)+" ",1),t(k,{block:""},{default:e(()=>[r(l(s.rollNumber||s.codeNumber),1)]),_:2},1024),t(C,{design:"primary",size:"sm"},{default:e(()=>[r(l(s.feeType),1)]),_:2},1024)]),_:2},1024),t(c,{name:"codeNumber"},{default:e(()=>[r(l(s.codeNumber),1)]),_:2},1024),t(c,{name:"fatherName"},{default:e(()=>[r(l(s.fatherName)+" ",1),t(k,{block:""},{default:e(()=>[r(l(s.contactNumber),1)]),_:2},1024)]),_:2},1024),t(c,{name:"course"},{default:e(()=>[r(l(s.courseName)+" ",1),t(k,{block:""},{default:e(()=>[r(l(s.batchName),1)]),_:2},1024)]),_:2},1024),t(c,{name:"amount"},{default:e(()=>[r(l(s.amount.formatted),1)]),_:2},1024),t(c,{name:"date"},{default:e(()=>[r(l(s.date.formatted),1)]),_:2},1024),t(c,{name:"ledger"},{default:e(()=>{var f,D,H,O;return[r(l((D=(f=s.payment)==null?void 0:f.ledger)==null?void 0:D.name)+" ",1),t(k,{block:""},{default:e(()=>{var S;return[r(l((S=s.payment)==null?void 0:S.methodName),1)]}),_:2},1024),(O=(H=s.payment)==null?void 0:H.summary)!=null&&O.length?(m(),y(k,{key:0,block:""},{default:e(()=>[(m(!0),w(T,null,I(s.payment.summary,S=>(m(),w("div",null,l(S),1))),256))]),_:2},1024)):v("",!0)]}),_:2},1024),t(c,{name:"paymentMethod"},{default:e(()=>{var f;return[r(l((f=s.payment)==null?void 0:f.methodName),1)]}),_:2},1024),t(c,{name:"feeInstallments"},{default:e(()=>[r(l(s.feeInstallments),1)]),_:2},1024),t(c,{name:"feeHeads"},{default:e(()=>[(m(!0),w(T,null,I(s.feePayments,f=>(m(),w("div",null,l(f.feeHead)+" "+l(f.amount.formatted),1))),256))]),_:2},1024),t(c,{name:"user"},{default:e(()=>{var f,D;return[r(l(((D=(f=s.user)==null?void 0:f.profile)==null?void 0:D.name)||"-"),1)]}),_:2},1024),t(c,{name:"action"},{default:e(()=>[t(K,null,{default:e(()=>[t(j,{icon:"fas fa-print",onClick:f=>q(s)},{default:e(()=>[r(l(d.$trans("global.print",{attribute:d.$trans("student.fee.receipt")})),1)]),_:2},1032,["onClick"]),t(j,{icon:"fas fa-arrow-circle-right",onClick:f=>N(_).push({name:"StudentShowFee",params:{uuid:s.studentUuid}})},{default:e(()=>[r(l(d.$trans("global.show",{attribute:d.$trans("student.fee.fee")})),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["header","footer","meta"])]),_:1},8,["is-loading"])]),_:1})],64)}}});export{ge as default};
