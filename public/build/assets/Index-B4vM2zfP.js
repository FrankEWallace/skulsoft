import{u as O,m as V,I as x,q as P,r as i,t as y,o as m,w as t,d as v,b as f,f as _,v as p,x as n,e as o,i as Q,j as X,k as Y,p as Z,L as ee,a as F,F as L,y as te,K as ae}from"./app-Cvm44xuh.js";import{i as oe,t as se,a as le}from"./table-FwhM-Z75.js";const ne={class:"grid grid-cols-3 gap-6"},re={class:"col-span-3 sm:col-span-1"},ie={class:"col-span-3 sm:col-span-1"},ue={class:"col-span-3 sm:col-span-1"},pe={class:"col-span-3 sm:col-span-1"},ce={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default:()=>({})}},emits:["hide"],setup(T,{emit:b}){const h=O(),A=b,S=T,g={name:"",batch:"",type:"",groups:[],showDetail:!0},c=V({...g}),q=x(S.initUrl),d=V({batch:"",isLoaded:!(h.query.batch||h.query.groups)});return P(async()=>{d.batch=h.query.batch,d.type=h.query.type,d.groups=h.query.groups?h.query.groups.split(","):[],d.isLoaded=!0}),(s,e)=>{const U=i("BaseSelectSearch"),B=i("BaseInput"),C=i("BaseSelect"),w=i("FilterForm");return m(),y(w,{"init-form":g,form:c,multiple:["groups"],onHide:e[5]||(e[5]=r=>A("hide"))},{default:t(()=>[v("div",ne,[v("div",re,[d.isLoaded?(m(),y(U,{key:0,name:"batch",label:s.$trans("global.select",{attribute:s.$trans("academic.batch.batch")}),modelValue:c.batch,"onUpdate:modelValue":e[0]||(e[0]=r=>c.batch=r),error:_(q).batch,"onUpdate:error":e[1]||(e[1]=r=>_(q).batch=r),"value-prop":"uuid","init-search":d.batch,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:t(r=>[p(n(r.value.course.name)+" "+n(r.value.name),1)]),listOption:t(r=>[p(n(r.option.course.nameWithTerm)+" "+n(r.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):f("",!0)]),v("div",ie,[o(B,{type:"text",modelValue:c.name,"onUpdate:modelValue":e[2]||(e[2]=r=>c.name=r),name:"name",label:s.$trans("student.props.name")},null,8,["modelValue","label"])]),v("div",ue,[d.isLoaded?(m(),y(C,{key:0,modelValue:c.type,"onUpdate:modelValue":e[3]||(e[3]=r=>c.type=r),name:"type",label:s.$trans("student.service_request.props.type"),options:T.preRequisites.types},null,8,["modelValue","label","options"])):f("",!0)]),v("div",pe,[o(C,{multiple:"",modelValue:c.groups,"onUpdate:modelValue":e[4]||(e[4]=r=>c.groups=r),name:"groups","label-prop":"name","value-prop":"uuid",label:s.$trans("student.group.group"),options:T.preRequisites.groups},null,8,["modelValue","label","options"])])])]),_:1},8,["form"])}}},de={class:"p-2"},me={key:0,class:"far fa-circle-check fa-lg text-success"},ge={class:"text-danger"},be={class:"grid grid-cols-3 gap-6 px-4 py-2"},fe={class:"col-span-3 sm:col-span-1"},_e={key:0,class:"col-span-3 sm:col-span-1"},ye={name:"StudentServiceAllocation"},Se=Object.assign(ye,{setup(T){const b=O();Q();const h=X();Y("emitter");const A={batch:"",name:"",selectAll:!1,students:[],type:"",requestType:"",transportStoppage:""},S="student/serviceAllocation/",g=Z(!1),c=V({types:[],groups:[]}),q=x(S),d=V({data:[]}),s=V({...A});V({});const e=V({...oe}),U=async()=>{g.value=!0,await h.dispatch(S+"preRequisite").then(u=>{g.value=!1,Object.assign(c,u)}).catch(u=>{g.value=!1})},B=async()=>{g.value=!0,await h.dispatch(S+"fetch",{params:b.query}).then(u=>{g.value=!1,s.batch=b.query.batch,s.name=b.query.name,s.type=b.query.type,Object.assign(d,u),e.pageItems=u.data.map(l=>l.uuid)}).catch(u=>{g.value=!1})},C=()=>{Object.assign(s,ae(A))},w=()=>{e.global=!e.global,s.selectAll=e.global},r=async()=>{e.items=[],e.pageItems=[],e.all=!1,s.selectAll=!1,C(),await B()};return ee(()=>[e.items,e.pageItems],([u,l],[R,I])=>{s.students=u,e.all=le(e)}),P(async()=>{await U(),b.query.batch&&await B()}),(u,l)=>{const R=i("PageHeaderAction"),I=i("PageHeader"),N=i("ParentTransition"),H=i("BaseAlert"),j=i("BaseCard"),E=i("BaseArrayCheckbox"),M=i("BaseCheckbox"),k=i("DataCell"),$=i("TextMuted"),G=i("DataRow"),z=i("DataTable"),K=i("CustomCheckbox"),W=i("BaseSelect"),J=i("FormAction");return m(),F(L,null,[o(I,{title:u.$trans(_(b).meta.label),navs:[{label:u.$trans("student.student"),path:"Student"}]},{default:t(()=>[o(R,{url:"students/",name:"Student",title:u.$trans(_(b).meta.label),actions:[],"dropdown-actions":[],headers:[]},null,8,["title"])]),_:1},8,["title","navs"]),o(N,{appear:"",visibility:!0},{default:t(()=>[o(ce,{onAfterFilter:B,"init-url":S,"pre-requisites":c},null,8,["pre-requisites"])]),_:1}),d.data.length==0?(m(),y(j,{key:0,"no-padding":"","no-content-padding":"","is-loading":g.value},{title:t(()=>[p(n(u.$trans("student.service_allocation.service_allocation")),1)]),default:t(()=>[v("div",de,[o(H,{size:"xs",design:"error"},{default:t(()=>[p(n(u.$trans("general.errors.record_not_found")),1)]),_:1})])]),_:1},8,["is-loading"])):f("",!0),d.data.length>0?(m(),y(N,{key:1,appear:"",visibility:!0},{default:t(()=>[o(z,{onToggleSelectAll:l[2]||(l[2]=a=>e.items=_(se)(a,e)),onToggleGlobalSelect:w,selected:e,header:d.headers,meta:d.meta,module:"student.service_allocation",onRefresh:B},{actionButton:t(()=>l[7]||(l[7]=[])),default:t(()=>[(m(!0),F(L,null,te(d.data,a=>(m(),y(G,{key:a.uuid},{default:t(()=>[o(k,{name:"selectAll"},{default:t(()=>[e.global?f("",!0):(m(),y(E,{key:0,items:e.items,"onUpdate:items":l[0]||(l[0]=D=>e.items=D),value:a.uuid},null,8,["items","value"])),e.global?(m(),y(M,{key:1,modelValue:e.global,"onUpdate:modelValue":l[1]||(l[1]=D=>e.global=D)},null,8,["modelValue"])):f("",!0)]),_:2},1024),o(k,{name:"codeNumber"},{default:t(()=>[p(n(a.codeNumber)+" ",1),a.optIn?(m(),F("i",me)):f("",!0),o($,{block:""},{default:t(()=>[p(n(a.joiningDate.formatted),1)]),_:2},1024)]),_:2},1024),o(k,{name:"name"},{default:t(()=>[p(n(a.name)+" ",1),o($,{block:""},{default:t(()=>[p(n(a.gender.label),1)]),_:2},1024)]),_:2},1024),o(k,{name:"course"},{default:t(()=>[p(n(a.courseName)+" ",1),o($,{block:""},{default:t(()=>[p(n(a.batchName),1)]),_:2},1024)]),_:2},1024),o(k,{name:"contactNumber"},{default:t(()=>[p(n(a.contactNumber)+" ",1),o($,{block:""},{default:t(()=>[p(n(a.email),1)]),_:2},1024)]),_:2},1024),o(k,{name:"parent"},{default:t(()=>[p(n(a.fatherName)+" ",1),o($,{block:""},{default:t(()=>[p(n(a.motherName),1)]),_:2},1024)]),_:2},1024),o(k,{name:"address"},{default:t(()=>[p(n(a.shortAddress)+" ",1),a.transportStoppage?(m(),y($,{key:0,block:""},{default:t(()=>[v("span",ge,n(a.transportStoppage),1)]),_:2},1024)):f("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["selected","header","meta"])]),_:1})):f("",!0),e.items.length>0?(m(),y(N,{key:2,appear:"",visibility:!0},{default:t(()=>[o(j,{"is-loading":g.value},{title:t(()=>[p(n(u.$trans("student.service_allocation.service_allocation")),1)]),default:t(()=>[o(J,{"no-card":"","keep-adding":!1,"init-url":S,action:"allocate","init-form":A,form:s,"after-submit":r},{default:t(()=>[v("div",be,[v("div",fe,[o(K,{label:u.$trans("student.service_request.props.request_type"),options:c.requestTypes,modelValue:s.requestType,"onUpdate:modelValue":l[3]||(l[3]=a=>s.requestType=a),error:_(q).requestType,"onUpdate:error":l[4]||(l[4]=a=>_(q).requestType=a)},null,8,["label","options","modelValue","error"])]),_(b).query.type=="transport"&&s.requestType=="opt_in"?(m(),F("div",_e,[o(W,{modelValue:s.transportStoppage,"onUpdate:modelValue":l[5]||(l[5]=a=>s.transportStoppage=a),name:"transportStoppage",label:u.$trans("transport.stoppage.stoppage"),options:c.transportStoppages,"label-prop":"name","value-prop":"uuid",error:_(q).transportStoppage,"onUpdate:error":l[6]||(l[6]=a=>_(q).transportStoppage=a)},null,8,["modelValue","label","options","error"])])):f("",!0)])]),_:1},8,["form"])]),_:1},8,["is-loading"])]),_:1})):f("",!0)],64)}}});export{Se as default};
