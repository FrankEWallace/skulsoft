import{u as w,m as l,I as H,q as $,r as u,t as R,o as S,w as m,d as q,b as U,f as s,v as A,x as h,e as d,i as T,j as D,k as V,E as x,z as C,p as E,a as L,F as N,K as z}from"./app-Cvm44xuh.js";const W={class:"grid grid-cols-4 gap-6"},I={class:"col-span-4 sm:col-span-1"},K={class:"col-span-4 sm:col-span-1"},M={__name:"AbsenteeFilter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default(){return{}}}},emits:["hide"],setup(F,{emit:i}){const _=w(),y=i,o=F,b={date:"",batch:""},t=l({...b}),r=H(o.initUrl);l({sessions:o.preRequisites.sessions});const n=l({batch:"",isLoaded:!_.query.batch});return $(async()=>{n.batch=_.query.batch,n.isLoaded=!0}),(p,a)=>{const v=u("BaseSelectSearch"),f=u("DatePicker"),g=u("FilterForm");return S(),R(g,{"init-form":b,form:t,onHide:a[4]||(a[4]=e=>y("hide"))},{default:m(()=>[q("div",W,[q("div",I,[n.isLoaded?(S(),R(v,{key:0,name:"batch",label:p.$trans("global.select",{attribute:p.$trans("academic.batch.batch")}),modelValue:t.batch,"onUpdate:modelValue":a[0]||(a[0]=e=>t.batch=e),error:s(r).batch,"onUpdate:error":a[1]||(a[1]=e=>s(r).batch=e),"value-prop":"uuid","init-search":n.batch,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:m(e=>[A(h(e.value.course.nameWithTerm)+" "+h(e.value.name),1)]),listOption:m(e=>[A(h(e.option.course.nameWithTerm)+" "+h(e.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):U("",!0)]),q("div",K,[d(f,{modelValue:t.date,"onUpdate:modelValue":a[2]||(a[2]=e=>t.date=e),name:"date",label:p.$trans("student.attendance.props.date"),"no-clear":"",error:s(r).date,"onUpdate:error":a[3]||(a[3]=e=>s(r).date=e)},null,8,["modelValue","label","error"])])])]),_:1},8,["form"])}}},G={name:"StudentAttendanceAbsentee"},X=Object.assign(G,{setup(F){const i=w(),_=T(),y=D();V("emitter");const o=V("$trans");x();let b=[];C("student:list-attendance")&&(b=["print","pdf","excel"]);const t={batch:"",date:"",students:[]},r="student/attendance/",n=E(!1),p=l({});H(r);const a=l({headers:[],data:[],meta:{total:0,isActionable:!1}}),v=l({...t}),f=l({meta:{},defaultAttendanceType:{code:"P",label:o("student.attendance.types.present")}}),g=async()=>{n.value=!0,await y.dispatch(r+"preRequisite").then(c=>{n.value=!1,Object.assign(p,c)}).catch(c=>{n.value=!1})},e=async()=>{n.value=!0,await y.dispatch(r+"fetch",{params:i.query}).then(c=>{n.value=!1,t.batch=i.query.batch,t.date=i.query.date,t.students=c.data,f.meta=c.meta,f.meta.isForceHoliday?(t.markAsHoliday=!0,t.holidayReason=f.meta.holidayReason):(t.markAsHoliday=!1,t.holidayReason=""),Object.assign(v,z(t)),Object.assign(a,c)}).catch(c=>{n.value=!1})};return $(async()=>{await g(),i.query.batch&&i.query.date&&await e()}),(c,k)=>{const j=u("BaseButton"),O=u("PageHeaderAction"),P=u("PageHeader"),B=u("ParentTransition");return S(),L(N,null,[d(P,{title:s(o)(s(i).meta.label),navs:[{label:s(o)("student.student"),path:"Student"}]},{default:m(()=>[d(O,{url:"student/attendance/",name:"StudentAttendance",title:s(o)("student.attendance.absentees"),actions:[],"dropdown-actions":s(b)},{default:m(()=>[d(j,{design:"primary",onClick:k[0]||(k[0]=J=>s(_).push({name:"StudentAttendance"}))},{default:m(()=>[A(h(s(o)("global.list",{attribute:s(o)("student.attendance.attendance")})),1)]),_:1})]),_:1},8,["title","dropdown-actions"])]),_:1},8,["title","navs"]),d(B,{appear:"",visibility:!0},{default:m(()=>[d(M,{onAfterFilter:e,"pre-requisites":p,"init-url":r},null,8,["pre-requisites"])]),_:1}),d(B,{appear:"",visibility:!0})],64)}}});export{X as default};
