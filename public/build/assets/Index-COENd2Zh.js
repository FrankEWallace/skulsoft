import{u as H,j as T,p as z,I as K,m as S,q as W,r as m,t as F,o as s,w as a,d as v,b as k,f as c,v as _,a as y,x as o,e as i,i as Z,k as I,F as j,y as L,K as D,N as ee}from"./app-Cvm44xuh.js";const te={class:"grid grid-cols-3 gap-6"},ae={class:"col-span-3 sm:col-span-1"},oe={key:0,class:"ml-1"},ne={key:0,class:"ml-1"},se={class:"col-span-3 sm:col-span-1"},re={class:"col-span-3 sm:col-span-1"},le={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default(){return{}}}},emits:["hide","cancel"],setup(O,{emit:V}){const b=H();T();const A=V,d=O,$={exam:"",batch:"",showAllStudent:!1};z(!1);const n=K(d.initUrl),r=S({...$});S({exams:d.preRequisites.exams});const u=S({exam:"",batch:"",isLoaded:!(b.query.exam&&b.query.batch)}),B=()=>{A("cancel")},C=async h=>{if(!h){r.batch="";return}r.batch=h||""};return W(async()=>{u.exam=b.query.exam,r.exam=b.query.exam,u.batch=b.query.batch,r.batch=b.query.batch,b.query.batch&&await C(b.query.batch),u.isLoaded=!0}),(h,l)=>{const M=m("BaseSelect"),E=m("BaseSelectSearch"),t=m("BaseSwitch"),w=m("FilterForm");return s(),F(w,{"init-form":$,form:r,onCancel:B,onHide:l[5]||(l[5]=e=>A("hide"))},{default:a(()=>[v("div",te,[v("div",ae,[u.isLoaded?(s(),F(M,{key:0,modelValue:r.exam,"onUpdate:modelValue":l[0]||(l[0]=e=>r.exam=e),name:"exam",label:h.$trans("exam.exam"),"value-prop":"uuid",options:O.preRequisites.exams,error:c(n).exam,"onUpdate:error":l[1]||(l[1]=e=>c(n).exam=e)},{selectedOption:a(e=>{var q,x;return[_(o(e.value.name)+" ",1),e.value.term?(s(),y("span",oe,"("+o(((x=(q=e.value.term)==null?void 0:q.division)==null?void 0:x.name)||h.$trans("general.all"))+")",1)):k("",!0)]}),listOption:a(e=>{var q,x;return[_(o(e.option.name)+" ",1),e.option.term?(s(),y("span",ne,"("+o(((x=(q=e.option.term)==null?void 0:q.division)==null?void 0:x.name)||h.$trans("general.all"))+")",1)):k("",!0)]}),_:1},8,["modelValue","label","options","error"])):k("",!0)]),v("div",se,[u.isLoaded?(s(),F(E,{key:0,name:"batch",label:h.$trans("global.select",{attribute:h.$trans("academic.batch.batch")}),modelValue:r.batch,"onUpdate:modelValue":l[2]||(l[2]=e=>r.batch=e),error:c(n).batch,"onUpdate:error":l[3]||(l[3]=e=>c(n).batch=e),"value-prop":"uuid","init-search":u.batch,"search-key":"course_batch","search-action":"academic/batch/list",onChange:C},{selectedOption:a(e=>[_(o(e.value.course.name)+" "+o(e.value.name),1)]),listOption:a(e=>[_(o(e.option.course.nameWithTerm)+" "+o(e.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):k("",!0)]),v("div",re,[i(t,{vertical:"",modelValue:r.showAllStudent,"onUpdate:modelValue":l[4]||(l[4]=e=>r.showAllStudent=e),name:"showAllStudent",label:h.$trans("global.list_all",{attribute:h.$trans("student.student")})},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},ie={class:"p-2"},me={class:"divide-y divide-gray-200 dark:divide-gray-700"},ce={class:"col-span-4 sm:col-span-1"},de={class:"mt-1"},ue={key:0,class:"col-span-4 sm:col-span-3"},pe={class:"flex flex-col sm:flex-row gap-2"},be={class:"mb-3"},he={class:"mb-3"},fe={key:0,class:"mt-2"},ve={name:"ExamObservationMark"},$e=Object.assign(ve,{setup(O){const V=H(),b=Z(),A=T();I("emitter");const d={exam:"",batch:"",students:[]},$="exam/observationMark/",n=z(!1),r=S({exams:[]}),u=K($),B=S({...d}),C=S({meta:{},showComment:!0}),h=async()=>{n.value=!0,await A.dispatch($+"preRequisite").then(t=>{n.value=!1,Object.assign(r,t)}).catch(t=>{n.value=!1})},l=()=>{d.exam="",d.batch="",d.students=[],Object.assign(B,D(d))},M=async()=>{V.query.batch&&(n.value=!0,await A.dispatch($+"fetch",{params:V.query}).then(t=>{n.value=!1,d.exam=V.query.exam,d.batch=V.query.batch,d.students=t.data,C.meta=t.meta,Object.assign(B,D(d))}).catch(t=>{n.value=!1}))},E=async()=>{await ee()&&(n.value=!0,await A.dispatch($+"remove",{form:V.query}).then(t=>{n.value=!1,M()}).catch(t=>{n.value=!1}))};return W(async()=>{await h(),await M()}),(t,w)=>{const e=m("BaseButton"),q=m("PageHeaderAction"),x=m("PageHeader"),G=m("ParentTransition"),J=m("BaseAlert"),P=m("BaseCheckbox"),Q=m("BaseDataView"),R=m("BaseInput"),X=m("FormAction"),Y=m("BaseCard");return s(),y(j,null,[i(x,{title:t.$trans(c(V).meta.label),navs:[{label:t.$trans("exam.exam"),path:"Exam"}]},{default:a(()=>[i(q,null,{default:a(()=>[i(e,{design:"white",onClick:w[0]||(w[0]=p=>c(b).push({name:"ExamMark"}))},{default:a(()=>[_(o(t.$trans("exam.mark")),1)]),_:1}),i(e,{design:"white",onClick:w[1]||(w[1]=p=>c(b).push({name:"ExamComment"}))},{default:a(()=>[_(o(t.$trans("exam.comment")),1)]),_:1}),i(e,{design:"white",onClick:w[2]||(w[2]=p=>c(b).push({name:"ExamAttendance"}))},{default:a(()=>[_(o(t.$trans("student.attendance.attendance")),1)]),_:1})]),_:1})]),_:1},8,["title","navs"]),i(G,{appear:"",visibility:!0},{default:a(()=>[i(le,{onAfterFilter:M,onCancel:l,"init-url":$,"pre-requisites":r},null,8,["pre-requisites"])]),_:1}),i(Y,{"no-padding":"","no-content-padding":"","is-loading":n.value},{title:a(()=>[_(o(t.$trans("exam.record")),1)]),action:a(()=>[C.meta.observationMarkRecorded?(s(),F(e,{key:0,design:"error",onClick:E},{default:a(()=>[_(o(t.$trans("global.remove",{attribute:t.$trans("exam.observation_mark")})),1)]),_:1})):k("",!0)]),default:a(()=>[v("div",ie,[B.students.length==0?(s(),F(J,{key:0,size:"xs",design:"error"},{default:a(()=>[_(o(t.$trans("general.errors.record_not_found")),1)]),_:1})):k("",!0)]),B.students.length?(s(),F(X,{key:0,"no-card":"","button-padding":"","keep-adding":!1,"stay-on":!0,"init-url":$,action:"store","init-form":d,form:B},{default:a(()=>[v("div",me,[(s(!0),y(j,null,L(B.students,(p,g)=>(s(),y("div",{class:"grid grid-cols-4 gap-6 px-4 py-2",key:p.uuid},[v("div",ce,[i(Q,null,{default:a(()=>[_(o(p.name)+" ("+o(p.rollNumber||p.codeNumber)+") ",1),v("div",de,[i(P,{modelValue:p.isNotApplicable,"onUpdate:modelValue":f=>p.isNotApplicable=f,name:`students.${g}.isNotApplicable`,label:t.$trans("global.is_not",{attribute:t.$trans("exam.schedule.props.applicable")})},null,8,["modelValue","onUpdate:modelValue","name","label"])])]),_:2},1024)]),p.isNotApplicable?k("",!0):(s(),y("div",ue,[v("div",pe,[(s(!0),y(j,null,L(p.marks,(f,N)=>(s(),y("div",null,[v("div",be,[i(R,{type:"text",modelValue:f.obtainedMark,"onUpdate:modelValue":U=>f.obtainedMark=U,name:`students.${g}.marks.${N}.obtainedMark`,label:f.name+" ("+f.maxMark+")",error:c(u)[`students.${g}.marks.${N}.obtainedMark`],"onUpdate:error":U=>c(u)[`students.${g}.marks.${N}.obtainedMark`]=U},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])]),v("div",he,[i(R,{type:"text",modelValue:f.comment,"onUpdate:modelValue":U=>f.comment=U,placeholder:t.$trans("exam.comment"),error:c(u)[`students.${g}.marks.${N}.comment`],"onUpdate:error":U=>c(u)[`students.${g}.marks.${N}.comment`]=U},null,8,["modelValue","onUpdate:modelValue","placeholder","error","onUpdate:error"])])]))),256))]),C.showComment?(s(),y("div",fe,[i(R,{type:"text",modelValue:p.comment,"onUpdate:modelValue":f=>p.comment=f,name:`students.${g}.comment`,placeholder:t.$trans("exam.incharge_comment"),error:c(u)[`students.${g}.comment`],"onUpdate:error":f=>c(u)[`students.${g}.comment`]=f},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])])):k("",!0)]))]))),128))])]),_:1},8,["form"])):k("",!0)]),_:1},8,["is-loading"])],64)}}});export{$e as default};
