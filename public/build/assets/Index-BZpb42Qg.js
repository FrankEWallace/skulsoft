import{u as L,j as H,p as S,I as N,m as F,q as j,L as P,r as y,t as T,o as c,w as u,a as $,b as g,d as x,e as p,f as o,v as V,x as i,i as A,z,F as I}from"./app-Cvm44xuh.js";const W={key:0,class:"grid grid-cols-3 gap-6"},G={class:"col-span-3 sm:col-span-1"},J={key:0,class:"col-span-3 sm:col-span-1"},K={class:"ml-1"},Q={class:"ml-1"},X={key:1,class:"col-span-3 sm:col-span-1"},Y={key:0,class:"ml-1"},Z={key:0,class:"ml-1"},ee={class:"col-span-3 sm:col-span-1"},te={class:"col-span-3 sm:col-span-1"},ae={class:"col-span-3 sm:col-span-1"},se={class:"col-span-3 sm:col-span-1"},re={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default(){return{}}}},emits:["hide"],setup(q,{emit:D}){const n=L();H();const B=D,v=q,k={type:"",term:"",exam:"",attempt:"",batch:"",students:[],resultDate:"",template:""};S(!1),S(!1);const s=N(v.initUrl),a=F({...k}),b=F({selectedType:"",exams:v.preRequisites.exams,students:[]}),m=F({exam:"",batch:"",students:[],isLoaded:!(n.query.exam||n.query.batch||n.query.students)}),l=async r=>{b.students=[],a.students=[],m.students=[]},f=()=>{b.students=[],a.students=[],m.students=[]},w=r=>{b.selectedType=v.preRequisites.types.find(t=>t.value===r)};return j(async()=>{if(_.isEmpty(n.query)){m.isLoaded=!0;return}a.type=n.query.type,m.exam=n.query.exam,a.exam=n.query.exam,a.attempt=n.query.attempt,m.batch=n.query.batch,a.batch=n.query.batch,n.query.batch&&(await l({uuid:n.query.batch}),a.students=n.query.students?n.query.students.split(","):[]),m.isLoaded=!0}),P(v.preRequisites,r=>{r&&(b.selectedType=r.types.find(t=>t.value===n.query.type))},{deep:!0}),(r,t)=>{const h=y("BaseSelect"),E=y("BaseSelectSearch"),R=y("DatePicker"),M=y("FilterForm");return c(),T(M,{"init-form":k,multiple:["students"],form:a,"filter-text":r.$trans("general.process"),onHide:t[14]||(t[14]=O=>B("hide"))},{default:u(()=>{var O,C;return[m.isLoaded?(c(),$("div",W,[x("div",G,[p(h,{modelValue:a.type,"onUpdate:modelValue":t[0]||(t[0]=e=>a.type=e),name:"type",label:r.$trans("exam.marksheet.type"),options:q.preRequisites.types,error:o(s).type,"onUpdate:error":t[1]||(t[1]=e=>o(s).type=e),onChange:w},null,8,["modelValue","label","options","error"])]),(O=b.selectedType)!=null&&O.requiresTerm?(c(),$("div",J,[p(h,{modelValue:a.term,"onUpdate:modelValue":t[2]||(t[2]=e=>a.term=e),name:"term",label:r.$trans("exam.term.term"),options:q.preRequisites.terms,"value-prop":"uuid",error:o(s).term,"onUpdate:error":t[3]||(t[3]=e=>o(s).term=e)},{selectedOption:u(e=>{var d;return[V(i(e.value.name)+" ",1),x("span",K,"("+i(((d=e.value.division)==null?void 0:d.name)||r.$trans("general.all"))+")",1)]}),listOption:u(e=>{var d;return[V(i(e.option.name)+" ",1),x("span",Q,"("+i(((d=e.option.division)==null?void 0:d.name)||r.$trans("general.all"))+")",1)]}),_:1},8,["modelValue","label","options","error"])])):g("",!0),(C=b.selectedType)!=null&&C.requiresExam?(c(),$("div",X,[p(h,{modelValue:a.exam,"onUpdate:modelValue":t[4]||(t[4]=e=>a.exam=e),name:"exam",label:r.$trans("exam.exam"),"value-prop":"uuid",options:q.preRequisites.exams,error:o(s).exam,"onUpdate:error":t[5]||(t[5]=e=>o(s).exam=e)},{selectedOption:u(e=>{var d,U;return[V(i(e.value.name)+" ",1),e.value.term?(c(),$("span",Y,"("+i(((U=(d=e.value.term)==null?void 0:d.division)==null?void 0:U.name)||r.$trans("general.all"))+")",1)):g("",!0)]}),listOption:u(e=>{var d,U;return[V(i(e.option.name)+" ",1),e.option.term?(c(),$("span",Z,"("+i(((U=(d=e.option.term)==null?void 0:d.division)==null?void 0:U.name)||r.$trans("general.all"))+")",1)):g("",!0)]}),_:1},8,["modelValue","label","options","error"])])):g("",!0),x("div",ee,[m.isLoaded?(c(),T(h,{key:0,modelValue:a.attempt,"onUpdate:modelValue":t[6]||(t[6]=e=>a.attempt=e),name:"attempt",label:r.$trans("exam.schedule.props.attempt"),options:q.preRequisites.attempts,error:o(s).attempt,"onUpdate:error":t[7]||(t[7]=e=>o(s).attempt=e)},null,8,["modelValue","label","options","error"])):g("",!0)]),x("div",te,[m.isLoaded?(c(),T(E,{key:0,name:"batch",label:r.$trans("global.select",{attribute:r.$trans("academic.batch.batch")}),modelValue:a.batch,"onUpdate:modelValue":t[8]||(t[8]=e=>a.batch=e),error:o(s).batch,"onUpdate:error":t[9]||(t[9]=e=>o(s).batch=e),"value-prop":"uuid","init-search":m.batch,"search-key":"course_batch","search-action":"academic/batch/list",onSelected:l,onRemoved:f},{selectedOption:u(e=>[V(i(e.value.course.name)+" "+i(e.value.name),1)]),listOption:u(e=>[V(i(e.option.course.nameWithTerm)+" "+i(e.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):g("",!0)]),x("div",ae,[p(R,{modelValue:a.resultDate,"onUpdate:modelValue":t[10]||(t[10]=e=>a.resultDate=e),name:"resultDate",label:r.$trans("exam.result_date"),"no-clear":"",error:o(s).resultDate,"onUpdate:error":t[11]||(t[11]=e=>o(s).resultDate=e)},null,8,["modelValue","label","error"])]),x("div",se,[p(h,{modelValue:a.template,"onUpdate:modelValue":t[12]||(t[12]=e=>a.template=e),name:"template",label:r.$trans("exam.marksheet.template"),options:q.preRequisites.templates,error:o(s).template,"onUpdate:error":t[13]||(t[13]=e=>o(s).template=e)},null,8,["modelValue","label","options","error"])])])):g("",!0)]}),_:1},8,["form","filter-text"])}}},ne={name:"ExamMarksheetProcess"},le=Object.assign(ne,{setup(q){const D=L(),n=A(),B=H(),v="exam/marksheet/",k=S(!0),s=S(!1),a=F({types:[],terms:[],exams:[],attempts:[]}),b=async()=>{s.value=!0,await B.dispatch(v+"processPreRequisite").then(l=>{s.value=!1,Object.assign(a,l)}).catch(l=>{s.value=!1})},m=async()=>{s.value=!0,await B.dispatch(v+"process",{params:D.query}).then(l=>{s.value=!1}).catch(l=>{s.value=!1})};return j(async()=>{await b()}),(l,f)=>{const w=y("BaseButton"),r=y("PageHeaderAction"),t=y("PageHeader"),h=y("ParentTransition"),E=y("BaseCard");return c(),$(I,null,[p(t,{title:l.$trans("global.process",{attribute:l.$trans("exam.marksheet.marksheet")}),navs:[{label:l.$trans("exam.exam"),path:"Exam"}]},{default:u(()=>[p(r,{name:"ExamMarksheetProcess",title:l.$trans("exam.marksheet.marksheet"),actions:[],"dropdown-actions":[],onToggleFilter:f[1]||(f[1]=R=>k.value=!k.value)},{default:u(()=>[o(z)("exam-marksheet:access")?(c(),T(w,{key:0,design:"white",onClick:f[0]||(f[0]=R=>o(n).push({name:"ExamMarksheetPrint"}))},{default:u(()=>[V(i(l.$trans("global.print",{attribute:l.$trans("exam.marksheet.marksheet")})),1)]),_:1})):g("",!0)]),_:1},8,["title"])]),_:1},8,["title","navs"]),p(h,{appear:"",visibility:k.value},{default:u(()=>[p(re,{"is-loading":s.value,onAfterFilter:m,"init-url":v,"pre-requisites":a,onHide:f[2]||(f[2]=R=>k.value=!1)},null,8,["is-loading","pre-requisites"])]),_:1},8,["visibility"]),p(h,{appear:"",visibility:!0},{default:u(()=>[p(E,{"no-padding":"","no-content-padding":"","is-loading":s.value},null,8,["is-loading"])]),_:1})],64)}}});export{le as default};
