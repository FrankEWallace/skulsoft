import{u as W,j as G,p as H,I as J,m as A,q as P,r as f,t as V,o as u,w as s,d as k,b as y,f as p,v as h,a as x,x as n,e as d,i as te,k as ae,F as D,y as T,K,N as se}from"./app-Cvm44xuh.js";const oe={class:"grid grid-cols-3 gap-6"},ne={class:"col-span-3 sm:col-span-1"},re={key:0,class:"ml-1"},le={key:0,class:"ml-1"},ie={class:"col-span-3 sm:col-span-1"},ue={class:"col-span-3 sm:col-span-1"},me={class:"col-span-3 sm:col-span-1"},de={class:"col-span-3 sm:col-span-1"},ce={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default(){return{}}}},emits:["hide","cancel"],setup(N,{emit:g}){const b=W(),F=G(),m=g,q=N,B={exam:"",attempt:"first",batch:"",subject:"",showAllStudent:!1},w=H(!1),r=J(q.initUrl),o=A({...B}),$=A({exams:q.preRequisites.exams,subjects:[]}),l=A({exam:"",batch:"",subject:"",isLoaded:!(b.query.exam&&b.query.batch&&b.query.subject)}),O=()=>{m("cancel")},M=async i=>{if(!i){o.batch="",o.subject="",$.subjects=[];return}o.batch=i||"",$.subjects=[],o.subject="",w.value=!0,await F.dispatch("academic/batch/listSubjects",{uuid:i||""}).then(a=>{$.subjects=a,w.value=!1}).catch(a=>{w.value=!1})};return P(async()=>{l.exam=b.query.exam,o.exam=b.query.exam,l.batch=b.query.batch,o.batch=b.query.batch,b.query.batch&&(await M(b.query.batch),l.subject=b.query.subject,o.subject=b.query.subject),l.isLoaded=!0}),(i,a)=>{const L=f("BaseSelect"),t=f("BaseSelectSearch"),v=f("BaseSwitch"),S=f("FilterForm");return u(),V(S,{"init-form":B,form:o,onCancel:O,onHide:a[9]||(a[9]=e=>m("hide"))},{default:s(()=>[k("div",oe,[k("div",ne,[l.isLoaded?(u(),V(L,{key:0,modelValue:o.exam,"onUpdate:modelValue":a[0]||(a[0]=e=>o.exam=e),name:"exam",label:i.$trans("exam.exam"),"value-prop":"uuid",options:N.preRequisites.exams,error:p(r).exam,"onUpdate:error":a[1]||(a[1]=e=>p(r).exam=e)},{selectedOption:s(e=>{var C,_;return[h(n(e.value.name)+" ",1),e.value.term?(u(),x("span",re,"("+n(((_=(C=e.value.term)==null?void 0:C.division)==null?void 0:_.name)||i.$trans("general.all"))+")",1)):y("",!0)]}),listOption:s(e=>{var C,_;return[h(n(e.option.name)+" ",1),e.option.term?(u(),x("span",le,"("+n(((_=(C=e.option.term)==null?void 0:C.division)==null?void 0:_.name)||i.$trans("general.all"))+")",1)):y("",!0)]}),_:1},8,["modelValue","label","options","error"])):y("",!0)]),k("div",ie,[l.isLoaded?(u(),V(L,{key:0,modelValue:o.attempt,"onUpdate:modelValue":a[2]||(a[2]=e=>o.attempt=e),name:"attempt",label:i.$trans("exam.schedule.props.attempt"),options:N.preRequisites.attempts,error:p(r).attempt,"onUpdate:error":a[3]||(a[3]=e=>p(r).attempt=e)},null,8,["modelValue","label","options","error"])):y("",!0)]),k("div",ue,[l.isLoaded?(u(),V(t,{key:0,name:"batch",label:i.$trans("global.select",{attribute:i.$trans("academic.batch.batch")}),modelValue:o.batch,"onUpdate:modelValue":a[4]||(a[4]=e=>o.batch=e),error:p(r).batch,"onUpdate:error":a[5]||(a[5]=e=>p(r).batch=e),"value-prop":"uuid","init-search":l.batch,"search-key":"course_batch","search-action":"academic/batch/list",onChange:M},{selectedOption:s(e=>[h(n(e.value.course.name)+" "+n(e.value.name),1)]),listOption:s(e=>[h(n(e.option.course.nameWithTerm)+" "+n(e.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):y("",!0)]),k("div",me,[d(L,{modelValue:o.subject,"onUpdate:modelValue":a[6]||(a[6]=e=>o.subject=e),name:"subject",label:i.$trans("academic.subject.subject"),"label-prop":"name","value-prop":"uuid",options:$.subjects,error:p(r).subject,"onUpdate:error":a[7]||(a[7]=e=>p(r).subject=e)},null,8,["modelValue","label","options","error"])]),k("div",de,[d(v,{vertical:"",modelValue:o.showAllStudent,"onUpdate:modelValue":a[8]||(a[8]=e=>o.showAllStudent=e),name:"showAllStudent",label:i.$trans("global.list_all",{attribute:i.$trans("student.student")})},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},pe={class:"p-2 space-y-2"},be={class:"divide-y divide-gray-200 dark:divide-gray-700"},fe={class:"col-span-4 sm:col-span-1"},he={class:"mt-1"},ve={key:0,class:"col-span-4 sm:col-span-3"},ye={class:"flex flex-col sm:flex-row gap-2"},ge={key:0,class:"mt-2"},$e={name:"ExamMark"},_e=Object.assign($e,{setup(N){const g=W(),b=te(),F=G();ae("emitter");const m={exam:"",batch:"",subject:"",students:[],attempt:"first"},q="exam/mark/",B=J(q),w=H(!1),r=H(!1),o=A({attempts:[],exams:[]}),$=A({...m}),l=A({meta:{},showComment:!0}),O=async()=>{r.value=!0,await F.dispatch(q+"preRequisite").then(t=>{r.value=!1,Object.assign(o,t)}).catch(t=>{r.value=!1})},M=()=>{m.exam="",m.batch="",m.subject="",m.students=[],m.attempt="first",Object.assign($,K(m))},i=async()=>{!g.query.batch||!g.query.subject||(r.value=!0,await F.dispatch(q+"fetch",{params:g.query}).then(t=>{r.value=!1,m.exam=g.query.exam,m.batch=g.query.batch,m.subject=g.query.subject,m.students=t.data,m.attempt=g.query.attempt,l.meta=t.meta,Object.assign($,K(m))}).catch(t=>{r.value=!1}))},a=async()=>{await se()&&(r.value=!0,await F.dispatch(q+"remove",{form:g.query}).then(t=>{r.value=!1,l.meta.marksheetStatus="pending",i()}).catch(t=>{r.value=!1}))},L=t=>{l.meta.marksheetStatus="pending"};return P(async()=>{await O(),await i()}),(t,v)=>{const S=f("BaseButton"),e=f("PageHeaderAction"),C=f("PageHeader"),_=f("BaseAlert"),Q=f("BaseImport"),z=f("ParentTransition"),X=f("BaseCheckbox"),Y=f("BaseDataView"),I=f("BaseInput"),Z=f("FormAction"),ee=f("BaseCard");return u(),x(D,null,[d(C,{title:t.$trans(p(g).meta.label),navs:[{label:t.$trans("exam.exam"),path:"Exam"}]},{default:s(()=>[d(e,null,{default:s(()=>[d(S,{design:"white",onClick:v[0]||(v[0]=c=>p(b).push({name:"ExamObservationMark"}))},{default:s(()=>[h(n(t.$trans("exam.observation_mark")),1)]),_:1}),d(S,{design:"white",onClick:v[1]||(v[1]=c=>p(b).push({name:"ExamComment"}))},{default:s(()=>[h(n(t.$trans("exam.comment")),1)]),_:1}),d(S,{design:"white",onClick:v[2]||(v[2]=c=>p(b).push({name:"ExamAttendance"}))},{default:s(()=>[h(n(t.$trans("student.attendance.attendance")),1)]),_:1}),d(S,{design:"white",onClick:v[3]||(v[3]=c=>w.value=!w.value)},{default:s(()=>[h(n(t.$trans("general.import")),1)]),_:1})]),_:1})]),_:1},8,["title","navs"]),d(z,{appear:"",visibility:w.value},{default:s(()=>[d(Q,{path:"exam/mark/import","additional-option":{},"has-validation":!1,onCancelled:v[4]||(v[4]=c=>w.value=!1),onHide:v[5]||(v[5]=c=>w.value=!1),onCompleted:i},{header:s(()=>[d(_,{size:"xs",design:"info"},{default:s(()=>[h(n(t.$trans("general.import_info")),1)]),_:1})]),_:1})]),_:1},8,["visibility"]),d(z,{appear:"",visibility:!0},{default:s(()=>[d(ce,{onAfterFilter:i,onCancel:M,"init-url":q,"pre-requisites":o},null,8,["pre-requisites"])]),_:1}),d(ee,{"no-padding":"","no-content-padding":"","is-loading":r.value},{title:s(()=>[h(n(t.$trans("exam.record")),1)]),action:s(()=>[l.meta.markRecorded?(u(),V(S,{key:0,design:"error",onClick:a},{default:s(()=>[h(n(t.$trans("global.remove",{attribute:t.$trans("exam.assessment.props.mark")})),1)]),_:1})):y("",!0)]),default:s(()=>[k("div",pe,[$.students.length==0?(u(),V(_,{key:0,size:"xs",design:"error"},{default:s(()=>[h(n(t.$trans("general.errors.record_not_found")),1)]),_:1})):y("",!0),l.meta.autoLockDate?(u(),V(_,{key:1,size:"xs",design:l.meta.isLocked?"error":"info"},{default:s(()=>[h(n(t.$trans("exam.schedule.auto_lock_marks_period_info",{attribute:l.meta.autoLockDate})),1)]),_:1},8,["design"])):y("",!0),l.meta.marksheetStatus=="processed"?(u(),V(_,{key:2,size:"xs",design:"info"},{default:s(()=>[h(n(t.$trans("exam.schedule.marksheet_processed_info")),1)]),_:1})):y("",!0)]),$.students.length?(u(),V(Z,{key:0,"no-card":"","button-padding":"","keep-adding":!1,"stay-on":!0,"init-url":q,action:"store","init-form":m,form:$,"after-submit":L},{default:s(()=>[k("div",be,[(u(!0),x(D,null,T($.students,(c,U)=>(u(),x("div",{class:"grid grid-cols-4 gap-6 px-4 py-2",key:c.uuid},[k("div",fe,[d(Y,null,{default:s(()=>[h(n(c.name)+" ("+n(c.rollNumber||c.codeNumber)+") ",1),k("div",he,[d(X,{modelValue:c.isNotApplicable,"onUpdate:modelValue":j=>c.isNotApplicable=j,name:`students.${U}.isNotApplicable`,label:t.$trans("global.is_not",{attribute:t.$trans("exam.schedule.props.applicable")})},null,8,["modelValue","onUpdate:modelValue","name","label"])])]),_:2},1024)]),c.isNotApplicable?y("",!0):(u(),x("div",ve,[k("div",ye,[(u(!0),x(D,null,T(c.marks,(j,R)=>(u(),V(I,{type:"text",modelValue:j.obtainedMark,"onUpdate:modelValue":E=>j.obtainedMark=E,name:`students.${U}.marks.${R}.obtainedMark`,label:j.name+" ("+j.maxMark+")",error:p(B)[`students.${U}.marks.${R}.obtainedMark`],"onUpdate:error":E=>p(B)[`students.${U}.marks.${R}.obtainedMark`]=E},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"]))),256))]),l.showComment?(u(),x("div",ge,[d(I,{type:"text",modelValue:c.comment,"onUpdate:modelValue":j=>c.comment=j,name:`students.${U}.comment`,placeholder:t.$trans("exam.comment"),error:p(B)[`students.${U}.comment`],"onUpdate:error":j=>p(B)[`students.${U}.comment`]=j},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])])):y("",!0)]))]))),128))])]),_:1},8,["form"])):y("",!0)]),_:1},8,["is-loading"])],64)}}});export{_e as default};
