import{q as A,r as v,a as b,b as i,o as l,d as z,e as p,w as s,v as o,x as u,Y as J,u as K,j as Q,I as W,p as X,m as D,M as Z,t as d,F as O,f as U,z as x,N as ee}from"./app-Cvm44xuh.js";import{f as ae}from"./currency-B2avElsq.js";import{_ as te,a as ne,b as le,c as re,d as ie,e as se}from"./Billdesk-CjG2zd7T.js";const oe=["action"],ue=["value"],me=["value"],de={name:"PaymentGatewayPayzone"},ye=Object.assign(de,{props:{payment:{type:Object,required:!0}},setup(t){const h=()=>{document.getElementById("payzoneForm").submit()};return A(()=>{setTimeout(h,3e3)}),(_,R)=>{const B=v("TextMuted");return t.payment?(l(),b("form",{key:0,id:"payzoneForm",class:"mt-4",method:"post",action:t.payment.pgUrl,onSubmit:J(h,["prevent"])},[z("input",{type:"hidden",name:"payload",value:t.payment.payload},null,8,ue),z("input",{type:"hidden",name:"signature",value:t.payment.signature},null,8,me),p(B,{block:""},{default:s(()=>[o(u(_.$trans("general.redirecting_to_payment_gateway")),1)]),_:1})],40,oe)):i("",!0)}}}),fe={key:0,class:"mt-4"},pe={name:"PaymentGatewayBillplz"},ce=Object.assign(pe,{props:{payment:{type:Object,required:!0}},setup(t){const h=t;return A(()=>{setTimeout(()=>{window.location.href=h.payment.pgUrl},3e3)}),(_,R)=>{const B=v("TextMuted");return t.payment?(l(),b("div",fe,[p(B,{block:""},{default:s(()=>[o(u(_.$trans("general.redirecting_to_payment_gateway")),1)]),_:1})])):i("",!0)}}}),ge={class:"grid grid-cols-1 sm:grid-cols-3 gap-x-4 gap-y-8 mb-4"},be={class:"grid grid-cols-3 gap-4"},we={class:"col-span-3 sm:col-span-1"},ke={key:0,class:"col-span-3"},$e={class:"mt-4"},ve={name:"StudentFeeOnlinePaymentForm"},Ge=Object.assign(ve,{props:{visibility:{type:Boolean,default:!1},initUrl:{type:String,default:"student/payment/"},uuid:{type:String,default:""},date:{type:Object,default(){return{}}},fee:{type:Object,default(){return{}}},feeGroup:{type:Object,default(){return{}}},fees:{type:Array,default(){return[]}},feeHead:{type:Object,default(){return{}}},preRequisites:{type:Object,default(){return{}}},tempPaymentUuid:{type:String,default:""}},emits:["close","completed"],setup(t,{emit:h}){const _=K(),R=Q(),B=h,r=t,m={uuid:r.uuid||_.params.uuid,feeHead:null,feeGroup:null,feeInstallments:[],feeInstallment:null,date:"",amount:"",gateway:"",tempPaymentUuid:r.tempPaymentUuid},I=W(r.initUrl),G=X(!1),n=D({initiated:!1,payment:null,multipleInstallmentTitle:""}),e=D({...m}),Y=()=>{V(),R.dispatch(r.initUrl+"resetFormErrors"),B("close")},C=()=>{n.initiated=!1,B("completed")},j=a=>{G.value=a},g=a=>!!r.preRequisites.paymentGateways.find(y=>y.value==a),V=()=>{n.initiated=!1,n.payment=null,e.gateway="",m.feeGroup=null,m.feeHead=null,m.feeInstallment=null,m.feeInstallments=[],m.date="",Object.assign(e,m)},w=async()=>{await ee()&&(G.value=!0,await R.dispatch(r.initUrl+"initiatePayment",e).then(a=>{if(a.hasOwnProperty("payment")&&a.payment.amount<=0){location.reload();return}n.initiated=!0,n.payment=a,G.value=!1}).catch(a=>{G.value=!1}))};return Z(()=>{var a,y,f,F,H,c;(a=r.feeGroup)!=null&&a.uuid?(m.feeGroup=r.feeGroup.uuid,m.amount=r.feeGroup.balance.value):(y=r.feeHead)!=null&&y.uuid?(m.feeHead=r.feeHead.uuid,m.amount=r.feeHead.balance.value):(f=r.fee)!=null&&f.uuid?(m.feeInstallment=r.fee.uuid,m.amount=r.fee.balance.value):r.fees.length>0&&(m.feeInstallments=r.fees.map(k=>k.uuid),m.amount=r.fees.reduce((k,M)=>k+M.balance.value,0),n.multipleInstallmentTitle=r.fees.map(k=>k.installment.title).join(", ")),((H=(F=r.preRequisites)==null?void 0:F.paymentGateways)==null?void 0:H.length)==1&&(m.gateway=r.preRequisites.paymentGateways[0].value),m.date=(c=r.date)==null?void 0:c.value,Object.assign(e,m)}),(a,y)=>{const f=v("BaseDataView"),F=v("BaseInput"),H=v("BaseRadioGroup"),c=v("BaseButton"),k=v("BaseModal");return l(),d(k,{show:t.visibility,onClose:Y},{title:s(()=>[o(u(a.$trans("global.pay",{attribute:a.$trans("student.fee.fee")})),1)]),default:s(()=>{var M,P,T,q,S,L,E,N;return[z("dl",ge,[p(f,{label:a.$trans("general.date")},{default:s(()=>[o(u(t.date.formatted),1)]),_:1},8,["label"]),(M=t.feeGroup)!=null&&M.uuid?(l(),b(O,{key:0},[p(f,{label:a.$trans("finance.fee_group.fee_group")},{default:s(()=>[o(u(t.feeGroup.name),1)]),_:1},8,["label"]),p(f,{label:a.$trans("finance.fee.balance")},{default:s(()=>[o(u(t.feeGroup.balance.formatted),1)]),_:1},8,["label"])],64)):(P=t.feeHead)!=null&&P.uuid?(l(),b(O,{key:1},[p(f,{label:a.$trans("finance.fee_head.fee_head")},{default:s(()=>[o(u(t.feeHead.name),1)]),_:1},8,["label"]),p(f,{label:a.$trans("finance.fee.balance")},{default:s(()=>[o(u(t.feeHead.balance.formatted),1)]),_:1},8,["label"])],64)):t.fee.uuid?(l(),b(O,{key:2},[(T=t.fee.installment)!=null&&T.title?(l(),d(f,{key:0,label:a.$trans("finance.fee_structure.installment")},{default:s(()=>[o(u(t.fee.installment.title),1)]),_:1},8,["label"])):i("",!0),p(f,{label:a.$trans("finance.fee.balance")},{default:s(()=>[o(u(t.fee.balance.formatted),1)]),_:1},8,["label"])],64)):t.fees.length>0?(l(),b(O,{key:3},[p(f,{label:a.$trans("finance.fee_structure.installment")},{default:s(()=>[o(u(n.multipleInstallmentTitle),1)]),_:1},8,["label"]),p(f,{label:a.$trans("finance.fee.balance")},{default:s(()=>[o(u(U(ae)(e.amount)),1)]),_:1},8,["label"])],64)):i("",!0)]),z("div",be,[z("div",we,[p(F,{disabled:!U(x)("fee:partial-payment")||r.fees.length>0,modelValue:e.amount,"onUpdate:modelValue":y[0]||(y[0]=$=>e.amount=$),name:"amount",label:a.$trans("student.fee.props.amount"),currency:"",error:U(I).amount,"onUpdate:error":y[1]||(y[1]=$=>U(I).amount=$)},null,8,["disabled","modelValue","label","error"])]),t.preRequisites.paymentGateways.length>1?(l(),b("div",ke,[p(H,{disabled:n.initiated||G.value,options:t.preRequisites.paymentGateways,name:"gateway",modelValue:e.gateway,"onUpdate:modelValue":y[2]||(y[2]=$=>e.gateway=$),error:U(I).gateway,"onUpdate:error":y[3]||(y[3]=$=>U(I).gateway=$),horizontal:""},null,8,["disabled","options","modelValue","error"])])):i("",!0)]),g("razorpay")&&e.gateway=="razorpay"?(l(),d(te,{key:0,"init-url":t.initUrl,form:e,payment:n.payment,onLoading:j,onRefresh:C},null,8,["init-url","form","payment"])):i("",!0),g("paystack")&&e.gateway=="paystack"?(l(),d(ne,{key:1,"init-url":t.initUrl,form:e,payment:n.payment,onLoading:j,onRefresh:C},null,8,["init-url","form","payment"])):i("",!0),g("stripe")&&e.gateway=="stripe"?(l(),d(le,{key:2,"init-url":t.initUrl,form:e,payment:n.payment,onCancel:V,onLoading:j,onRefresh:C},null,8,["init-url","form","payment"])):i("",!0),g("payzone")&&e.gateway=="payzone"&&((q=n==null?void 0:n.payment)!=null&&q.token)?(l(),d(ye,{key:3,"init-url":t.initUrl,form:e,payment:n.payment,onCancel:V,onLoading:j,onRefresh:C},null,8,["init-url","form","payment"])):i("",!0),g("paypal")&&e.gateway=="paypal"&&((S=n.payment)!=null&&S.token)?(l(),d(re,{key:4,"init-url":t.initUrl,form:e,payment:n.payment,onCancel:V,onLoading:j,onRefresh:C},null,8,["init-url","form","payment"])):i("",!0),g("ccavenue")&&e.gateway=="ccavenue"&&((L=n.payment)!=null&&L.token)?(l(),d(ie,{key:5,payment:n.payment},null,8,["payment"])):i("",!0),g("billdesk")&&e.gateway=="billdesk"&&((E=n.payment)!=null&&E.token)?(l(),d(se,{key:6,payment:n.payment},null,8,["payment"])):i("",!0),g("billplz")&&e.gateway=="billplz"&&((N=n.payment)!=null&&N.token)?(l(),d(ce,{key:7,payment:n.payment},null,8,["payment"])):i("",!0),z("div",$e,[e.gateway&&!G.value?(l(),b(O,{key:0},[e.gateway!="stripe"&&e.gateway!="payzone"&&e.gateway!="paypal"&&e.gateway!="ccavenue"&&e.gateway!="billdesk"&&e.gateway!="billplz"?(l(),d(c,{key:0,design:"primary",onClick:w},{default:s(()=>[o(u(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="stripe"&&!n.payment?(l(),d(c,{key:1,design:"primary",onClick:w},{default:s(()=>[o(u(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="payzone"&&!n.payment?(l(),d(c,{key:2,design:"primary",onClick:w},{default:s(()=>[o(u(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="paypal"&&!n.payment?(l(),d(c,{key:3,design:"primary",onClick:w},{default:s(()=>[o(u(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="ccavenue"&&!n.payment?(l(),d(c,{key:4,design:"primary",onClick:w},{default:s(()=>[o(u(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="billdesk"&&!n.payment?(l(),d(c,{key:5,design:"primary",onClick:w},{default:s(()=>[o(u(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="billplz"&&!n.payment?(l(),d(c,{key:6,design:"primary",onClick:w},{default:s(()=>[o(u(a.$trans("general.proceed")),1)]),_:1})):i("",!0)],64)):i("",!0)])]}),_:1},8,["show"])}}});export{Ge as _};
