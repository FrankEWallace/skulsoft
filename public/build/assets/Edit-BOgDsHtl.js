import{u as Z,i as I,j as x,I as ee,p as ae,m as M,q as se,r as p,a as u,o as n,t as O,b as _,e as i,w as b,f as r,F as h,y as w,n as D,d,v as N,x as $,K as te}from"./app-Cvm44xuh.js";const oe={class:"col-span-1"},le={class:"grid grid-cols-3 gap-2"},ne={class:"col-span-3 sm:col-span-2 lg:col-span-1"},re={class:"col-span-3 sm:col-span-2 lg:col-span-1"},ue={class:"text-danger"},ie={key:0,class:"col-span-3 sm:col-span-2 lg:col-span-1"},ce={class:"flex-row space-y-2"},pe={key:0,class:"col-span-3 sm:col-span-2 lg:col-span-1"},de={class:"flex-row space-y-2"},me={key:0,class:"mt-4 grid grid-cols-3 gap-2"},be={class:"col-span-3 sm:col-span-2 lg:col-span-1"},_e={key:0,class:"col-span-3 sm:col-span-2 lg:col-span-1"},$e={class:"mt-4 grid grid-cols-3 gap-2"},he={class:"col-span-3 sm:col-span-2 lg:col-span-1"},fe={class:"col-span-3 sm:col-span-2 lg:col-span-1"},Fe={class:"col-span-3 sm:col-span-2 lg:col-span-1"},Ve={name:"StudentEditFee"},ge=Object.assign(Ve,{props:{student:{type:Object,default(){return{}}}},setup(F){const V=Z(),z=I(),K=x(),j=F,C={feeGroups:[]},R="student/fee/",c=ee(R),T=ae(!1),v=M({directions:[],transportCircles:[],feeConcessions:[],frequencies:[]}),L=M({...C}),J=[],Q=o=>{Object.assign(v,o)},W=async()=>{T.value=!0,await K.dispatch("student/fee/fetch",{uuid:V.params.uuid}).then(o=>{let P=[];o.feeGroups.forEach(g=>{let k=[];g.fees.forEach(t=>{var S,f,q,A;t.hasTransportFee=t.hasTransportFee,t.transportCircle=((S=t.transportCircle)==null?void 0:S.uuid)||"",t.concession=((f=t.concession)==null?void 0:f.uuid)||"",t.hasLateFee=!!t.lateFee.applicable,t.lateFeeType=t.lateFee.type||"amount",t.lateFeeFrequency=((q=t.lateFee.frequency)==null?void 0:q.value)||"",t.lateFeeValue=((A=t.lateFee.value)==null?void 0:A.value)||"",t.dueDate=t.dueDate.value,t.records.forEach(m=>{var B,y,E;m.isOptional?m.isApplicable?m.customAmount=((B=m.amount)==null?void 0:B.value)||0:m.customAmount=((y=m.installmentAmount)==null?void 0:y.value)||0:m.customAmount=((E=m.amount)==null?void 0:E.value)||0}),t.isEditable=t.status.value=="unpaid"||t.status.value=="not_applicable",k.push(t)}),P.push({uuid:g.uuid,name:g.name,fees:k})}),C.feeGroups=P,Object.assign(L,te(C)),T.value=!1}).catch(o=>{T.value=!1})};return se(async()=>{if(!j.student.hasFeeStructureSet){z.push({name:"StudentShowFee",params:{uuid:j.student.uuid}});return}await W()}),(o,P)=>{const g=p("PageHeaderAction"),k=p("PageHeader"),t=p("BaseHeading"),S=p("DatePicker"),f=p("BaseSelect"),q=p("HelperText"),A=p("BaseLabel"),m=p("BaseCheckbox"),B=p("TextMuted"),y=p("BaseInput"),E=p("BaseFieldset"),X=p("FormAction"),Y=p("ParentTransition");return n(),u(h,null,[F.student.uuid?(n(),O(k,{key:0,title:o.$trans(r(V).meta.trans,{attribute:o.$trans(r(V).meta.label)}),navs:[{label:o.$trans("student.student"),path:"Student"},{label:F.student.contact.name,path:{name:"StudentShow",params:{uuid:F.student.uuid}}},{label:o.$trans("finance.fee.fee"),path:{name:"StudentShowFee",params:{uuid:F.student.uuid}}}]},{default:b(()=>[i(g,{"additional-actions":J})]),_:1},8,["title","navs"])):_("",!0),i(Y,{appear:"",visibility:!0},{default:b(()=>[i(X,{"pre-requisites":{uuid:r(V).params.uuid},onSetPreRequisites:Q,"no-data-fetch":"","init-url":R,action:"update","init-form":C,form:L,"keep-adding":!1,redirect:{name:"StudentShowFee",params:{uuid:r(V).params.uuid}},confirmation:""},{default:b(()=>[(n(!0),u(h,null,w(L.feeGroups,(H,s)=>(n(),u("div",{class:D(["grid grid-cols-1",{"mt-4":s>0}]),key:H.uuid},[d("div",oe,[i(t,null,{default:b(()=>[N($(H.name),1)]),_:2},1024),(n(!0),u(h,null,w(H.fees,(a,l)=>(n(),O(E,{class:"mt-4",key:a.uuid},{legend:b(()=>[N($(a.title)+" ",1),d("span",{class:D({"text-danger":a.status.color=="danger","text-success":a.status.color=="success","text-warning":a.status.color=="warning","text-primary":a.status.color=="primary"})},"("+$(a.status.label)+")",3)]),default:b(()=>[d("div",le,[d("div",ne,[i(S,{modelValue:a.dueDate,"onUpdate:modelValue":e=>a.dueDate=e,name:`feeGroups.${s}.fees.${l}.dueDate`,label:o.$trans("finance.fee_structure.props.due_date"),"no-clear":"",error:r(c)[`feeGroups.${s}.fees.${l}.dueDate`],"onUpdate:error":e=>r(c)[`feeGroups.${s}.fees.${l}.dueDate`]=e,disabled:!a.isEditable},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error","disabled"])]),d("div",re,[i(f,{modelValue:a.concession,"onUpdate:modelValue":e=>a.concession=e,name:`feeGroups.${s}.fees.${l}.concession`,label:o.$trans("finance.fee_concession.fee_concession"),options:v.feeConcessions,"label-prop":"name","value-prop":"uuid",error:r(c)[`feeGroups.${s}.fees.${l}.concession`],"onUpdate:error":e=>r(c)[`feeGroups.${s}.fees.${l}.concession`]=e,disabled:!a.isEditable||a.hasNoConcession},null,8,["modelValue","onUpdate:modelValue","name","label","options","error","onUpdate:error","disabled"]),a.hasNoConcession?(n(),O(q,{key:0},{default:b(()=>[d("span",ue,$(o.$trans("finance.fee_concession.no_concession")),1)]),_:1})):_("",!0)]),(n(!0),u(h,null,w(a.records,(e,U)=>(n(),u(h,null,[e.isOptional?(n(),u("div",ie,[d("div",ce,[i(A,null,{default:b(()=>[N($(e.head.name),1)]),_:2},1024),i(m,{modelValue:e.isApplicable,"onUpdate:modelValue":G=>e.isApplicable=G,name:`feeGroups.${s}.fees.${l}.hasLateFee.${U}.isApplicable`,label:o.$trans("global.is",{attribute:o.$trans("finance.fee_structure.props.applicable")}),disabled:!a.isEditable},null,8,["modelValue","onUpdate:modelValue","name","label","disabled"])])])):_("",!0)],64))),256)),(n(!0),u(h,null,w(a.records,(e,U)=>(n(),u(h,null,[!e.isOptional||e.isOptional&&e.isApplicable?(n(),u("div",pe,[d("div",de,[i(y,{modelValue:e.customAmount,"onUpdate:modelValue":G=>e.customAmount=G,name:`feeGroups.${s}.fees.${U}.amount`,label:e.head.name,currency:"",error:r(c)[`feeGroups.${s}.fees.${U}.amount`],"onUpdate:error":G=>r(c)[`feeGroups.${s}.fees.${U}.amount`]=G},{"additional-label":b(()=>[i(B,null,{default:b(()=>[e.paid.value>0?(n(),u("span",{key:0,class:D({"text-success":e.paid.value>0})},$(o.$trans("finance.fee.paid"))+" "+$(e.paid.formatted),3)):_("",!0),e.concession.value>0?(n(),u("span",{key:1,class:D({"text-danger":e.concession.value>0})},$(o.$trans("finance.fee_concession.fee_concession"))+" "+$(e.concession.formatted),3)):_("",!0)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])])])):_("",!0)],64))),256))]),a.hasTransportFee?(n(),u("div",me,[d("div",be,[i(f,{modelValue:a.transportCircle,"onUpdate:modelValue":e=>a.transportCircle=e,name:`feeGroups.${s}.fees.${l}.transportCircle`,label:o.$trans("transport.circle.circle"),options:v.transportCircles,"label-prop":"name","value-prop":"uuid",error:r(c)[`feeGroups.${s}.fees.${l}.transportCircle`],"onUpdate:error":e=>r(c)[`feeGroups.${s}.fees.${l}.transportCircle`]=e,disabled:!a.isEditable},null,8,["modelValue","onUpdate:modelValue","name","label","options","error","onUpdate:error","disabled"])]),a.transportCircle?(n(),u("div",_e,[i(f,{modelValue:a.direction,"onUpdate:modelValue":e=>a.direction=e,name:`feeGroups.${s}.fees.${l}.direction`,label:o.$trans("transport.circle.direction"),options:v.directions,error:r(c)[`feeGroups.${s}.fees.${l}.direction`],"onUpdate:error":e=>r(c)[`feeGroups.${s}.fees.${l}.direction`]=e,disabled:!a.isEditable},null,8,["modelValue","onUpdate:modelValue","name","label","options","error","onUpdate:error","disabled"])])):_("",!0)])):_("",!0),d("div",$e,[d("div",he,[i(m,{modelValue:a.hasLateFee,"onUpdate:modelValue":e=>a.hasLateFee=e,name:`feeGroups.${s}.fees.${l}.hasLateFee`,label:o.$trans("finance.fee_structure.props.has_late_fee"),disabled:!a.isEditable},null,8,["modelValue","onUpdate:modelValue","name","label","disabled"])]),a.hasLateFee?(n(),u(h,{key:0},[d("div",fe,[i(f,{modelValue:a.lateFeeFrequency,"onUpdate:modelValue":e=>a.lateFeeFrequency=e,name:`feeGroups.${s}.fees.${l}.lateFeeFrequency`,label:o.$trans("finance.fee_structure.props.late_fee_frequency"),options:v.frequencies,"label-prop":"label","value-prop":"value",error:r(c)[`feeGroups.${s}.fees.${l}.lateFeeFrequency`],"onUpdate:error":e=>r(c)[`feeGroups.${s}.fees.${l}.lateFeeFrequency`]=e,disabled:!a.isEditable},null,8,["modelValue","onUpdate:modelValue","name","label","options","error","onUpdate:error","disabled"])]),d("div",Fe,[i(y,{modelValue:a.lateFeeValue,"onUpdate:modelValue":e=>a.lateFeeValue=e,name:`feeGroups.${s}.fees.${l}.lateFeeValue`,label:o.$trans("finance.fee_structure.props.late_fee_value"),currency:"",error:r(c)[`feeGroups.${s}.fees.${l}.lateFeeValue`],"onUpdate:error":e=>r(c)[`feeGroups.${s}.fees.${l}.lateFeeValue`]=e,disabled:!a.isEditable},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error","disabled"])])],64)):_("",!0)])]),_:2},1024))),128))])],2))),128))]),_:1},8,["pre-requisites","form","redirect"])]),_:1})],64)}}});export{ge as default};
