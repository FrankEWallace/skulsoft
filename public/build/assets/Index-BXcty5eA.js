import{u as W,j,p as L,I as H,m as w,q as M,r as c,t as A,o as b,w as t,d as v,b as $,f as h,v as g,a as q,x as s,e as d,i as P,k as Q,F as E,y as X,K as R,N as Y}from"./app-Cvm44xuh.js";const Z={class:"grid grid-cols-3 gap-6"},ee={class:"col-span-3 sm:col-span-1"},ae={key:0,class:"ml-1"},te={key:0,class:"ml-1"},ne={class:"col-span-3 sm:col-span-1"},se={class:"col-span-3 sm:col-span-1"},oe={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default(){return{}}}},emits:["hide","cancel"],setup(D,{emit:k}){const m=W();j();const B=k,r=D,_={exam:"",batch:"",showAllStudent:!1};L(!1);const o=H(r.initUrl),l=w({..._});w({exams:r.preRequisites.exams});const f=w({exam:"",batch:"",isLoaded:!(m.query.exam&&m.query.batch)}),y=()=>{B("cancel")},S=async u=>{if(!u){l.batch="";return}l.batch=u||""};return M(async()=>{f.exam=m.query.exam,l.exam=m.query.exam,f.batch=m.query.batch,l.batch=m.query.batch,m.query.batch&&await S(m.query.batch),f.isLoaded=!0}),(u,i)=>{const C=c("BaseSelect"),N=c("BaseSelectSearch"),a=c("BaseSwitch"),p=c("FilterForm");return b(),A(p,{"init-form":_,form:l,onCancel:y,onHide:i[5]||(i[5]=e=>B("hide"))},{default:t(()=>[v("div",Z,[v("div",ee,[f.isLoaded?(b(),A(C,{key:0,modelValue:l.exam,"onUpdate:modelValue":i[0]||(i[0]=e=>l.exam=e),name:"exam",label:u.$trans("exam.exam"),"value-prop":"uuid",options:D.preRequisites.exams,error:h(o).exam,"onUpdate:error":i[1]||(i[1]=e=>h(o).exam=e)},{selectedOption:t(e=>{var V,x;return[g(s(e.value.name)+" ",1),e.value.term?(b(),q("span",ae,"("+s(((x=(V=e.value.term)==null?void 0:V.division)==null?void 0:x.name)||u.$trans("general.all"))+")",1)):$("",!0)]}),listOption:t(e=>{var V,x;return[g(s(e.option.name)+" ",1),e.option.term?(b(),q("span",te,"("+s(((x=(V=e.option.term)==null?void 0:V.division)==null?void 0:x.name)||u.$trans("general.all"))+")",1)):$("",!0)]}),_:1},8,["modelValue","label","options","error"])):$("",!0)]),v("div",ne,[f.isLoaded?(b(),A(N,{key:0,name:"batch",label:u.$trans("global.select",{attribute:u.$trans("academic.batch.batch")}),modelValue:l.batch,"onUpdate:modelValue":i[2]||(i[2]=e=>l.batch=e),error:h(o).batch,"onUpdate:error":i[3]||(i[3]=e=>h(o).batch=e),"value-prop":"uuid","init-search":f.batch,"search-key":"course_batch","search-action":"academic/batch/list",onChange:S},{selectedOption:t(e=>[g(s(e.value.course.name)+" "+s(e.value.name),1)]),listOption:t(e=>[g(s(e.option.course.nameWithTerm)+" "+s(e.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):$("",!0)]),v("div",se,[d(a,{vertical:"",modelValue:l.showAllStudent,"onUpdate:modelValue":i[4]||(i[4]=e=>l.showAllStudent=e),name:"showAllStudent",label:u.$trans("global.list_all",{attribute:u.$trans("student.student")})},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},re={class:"p-2"},le={class:"px-4 grid grid-cols-1 gap-6"},ie={class:"col"},ce={class:"divide-y divide-gray-200 dark:divide-gray-700"},de={class:"col-span-4 sm:col-span-1"},me={class:"mt-1"},ue={key:0,class:"col-span-4 sm:col-span-3"},pe={name:"ExamAttendance"},be=Object.assign(pe,{setup(D){const k=W(),m=P(),B=j();Q("emitter");const r={exam:"",batch:"",totalWorkingDays:"",students:[]},_="exam/attendance/",o=L(!1),l=w({exams:[]}),f=H(_),y=w({...r}),S=w({meta:{},showComment:!1}),u=async()=>{o.value=!0,await B.dispatch(_+"preRequisite").then(a=>{o.value=!1,Object.assign(l,a)}).catch(a=>{o.value=!1})},i=()=>{r.exam="",r.batch="",r.students=[],Object.assign(y,R(r))},C=async()=>{k.query.batch&&(o.value=!0,await B.dispatch(_+"fetch",{params:k.query}).then(a=>{o.value=!1,r.exam=k.query.exam,r.batch=k.query.batch,r.students=a.data,r.totalWorkingDays=a.meta.totalWorkingDays,S.meta=a.meta,Object.assign(y,R(r))}).catch(a=>{o.value=!1}))},N=async()=>{await Y()&&(o.value=!0,await B.dispatch(_+"remove",{form:k.query}).then(a=>{o.value=!1,C()}).catch(a=>{o.value=!1}))};return M(async()=>{await u(),await C()}),(a,p)=>{const e=c("BaseButton"),V=c("PageHeaderAction"),x=c("PageHeader"),T=c("ParentTransition"),I=c("BaseAlert"),O=c("BaseInput"),z=c("BaseCheckbox"),K=c("BaseDataView"),G=c("FormAction"),J=c("BaseCard");return b(),q(E,null,[d(x,{title:a.$trans(h(k).meta.label),navs:[{label:a.$trans("exam.exam"),path:"Exam"}]},{default:t(()=>[d(V,null,{default:t(()=>[d(e,{design:"white",onClick:p[0]||(p[0]=n=>h(m).push({name:"ExamMark"}))},{default:t(()=>[g(s(a.$trans("exam.mark")),1)]),_:1}),d(e,{design:"white",onClick:p[1]||(p[1]=n=>h(m).push({name:"ExamObservationMark"}))},{default:t(()=>[g(s(a.$trans("exam.observation_mark")),1)]),_:1}),d(e,{design:"white",onClick:p[2]||(p[2]=n=>h(m).push({name:"ExamComment"}))},{default:t(()=>[g(s(a.$trans("exam.comment")),1)]),_:1})]),_:1})]),_:1},8,["title","navs"]),d(T,{appear:"",visibility:!0},{default:t(()=>[d(oe,{onAfterFilter:C,onCancel:i,"init-url":_,"pre-requisites":l},null,8,["pre-requisites"])]),_:1}),d(J,{"no-padding":"","no-content-padding":"","is-loading":o.value},{title:t(()=>[g(s(a.$trans("exam.record")),1)]),action:t(()=>[S.meta.attendanceRecorded?(b(),A(e,{key:0,design:"error",onClick:N},{default:t(()=>[g(s(a.$trans("global.remove",{attribute:a.$trans("student.attendance.attendance")})),1)]),_:1})):$("",!0)]),default:t(()=>[v("div",re,[y.students.length==0?(b(),A(I,{key:0,size:"xs",design:"error"},{default:t(()=>[g(s(a.$trans("general.errors.record_not_found")),1)]),_:1})):$("",!0)]),y.students.length?(b(),A(G,{key:0,"no-card":"","button-padding":"","keep-adding":!1,"stay-on":!0,"init-url":_,action:"store","init-form":r,form:y},{default:t(()=>[v("div",le,[v("div",ie,[d(O,{type:"text",modelValue:y.totalWorkingDays,"onUpdate:modelValue":p[3]||(p[3]=n=>y.totalWorkingDays=n),name:"totalWorkingDays",placeholder:a.$trans("student.attendance.total_working_days"),error:h(f).totalWorkingDays,"onUpdate:error":p[4]||(p[4]=n=>h(f).totalWorkingDays=n)},null,8,["modelValue","placeholder","error"])])]),v("div",ce,[(b(!0),q(E,null,X(y.students,(n,F)=>(b(),q("div",{class:"grid grid-cols-4 gap-6 px-4 py-2",key:n.uuid},[v("div",de,[d(K,null,{default:t(()=>[g(s(n.name)+" ("+s(n.rollNumber||n.codeNumber)+") ",1),v("div",me,[d(z,{modelValue:n.isNotApplicable,"onUpdate:modelValue":U=>n.isNotApplicable=U,name:`students.${F}.isNotApplicable`,label:a.$trans("global.is_not",{attribute:a.$trans("exam.schedule.props.applicable")})},null,8,["modelValue","onUpdate:modelValue","name","label"])])]),_:2},1024)]),n.isNotApplicable?$("",!0):(b(),q("div",ue,[d(O,{type:"text",modelValue:n.attendance,"onUpdate:modelValue":U=>n.attendance=U,name:`students.${F}.attendance`,placeholder:a.$trans("student.attendance.types.present"),error:h(f)[`students.${F}.attendance`],"onUpdate:error":U=>h(f)[`students.${F}.attendance`]=U},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))]))),128))])]),_:1},8,["form"])):$("",!0)]),_:1},8,["is-loading"])],64)}}});export{be as default};
