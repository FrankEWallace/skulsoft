import{u as L,j as D,p as H,I as M,m as U,q as T,r as m,t as A,o as f,w as t,d as k,b as B,f as c,v as g,a as C,x as o,e as i,i as P,k as Q,F as R,y as X,K as j,N as Y}from"./app-Cvm44xuh.js";const Z={class:"grid grid-cols-3 gap-6"},ee={class:"col-span-3 sm:col-span-1"},ae={key:0,class:"ml-1"},te={key:0,class:"ml-1"},ne={class:"col-span-3 sm:col-span-1"},oe={class:"col-span-3 sm:col-span-1"},se={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default(){return{}}}},emits:["hide","cancel"],setup(N,{emit:y}){const h=L();D();const x=y,u=N,_={exam:"",batch:"",showAllStudent:!1};H(!1);const s=M(u.initUrl),r=U({..._});U({exams:u.preRequisites.exams});const d=U({exam:"",batch:"",isLoaded:!(h.query.exam&&h.query.batch)}),$=()=>{x("cancel")},S=async b=>{if(!b){r.batch="";return}r.batch=b||""};return T(async()=>{d.exam=h.query.exam,r.exam=h.query.exam,d.batch=h.query.batch,r.batch=h.query.batch,h.query.batch&&await S(h.query.batch),d.isLoaded=!0}),(b,l)=>{const F=m("BaseSelect"),O=m("BaseSelectSearch"),a=m("BaseSwitch"),V=m("FilterForm");return f(),A(V,{"init-form":_,form:r,onCancel:$,onHide:l[5]||(l[5]=e=>x("hide"))},{default:t(()=>[k("div",Z,[k("div",ee,[d.isLoaded?(f(),A(F,{key:0,modelValue:r.exam,"onUpdate:modelValue":l[0]||(l[0]=e=>r.exam=e),name:"exam",label:b.$trans("exam.exam"),"value-prop":"uuid",options:N.preRequisites.exams,error:c(s).exam,"onUpdate:error":l[1]||(l[1]=e=>c(s).exam=e)},{selectedOption:t(e=>{var q,w;return[g(o(e.value.name)+" ",1),e.value.term?(f(),C("span",ae,"("+o(((w=(q=e.value.term)==null?void 0:q.division)==null?void 0:w.name)||b.$trans("general.all"))+")",1)):B("",!0)]}),listOption:t(e=>{var q,w;return[g(o(e.option.name)+" ",1),e.option.term?(f(),C("span",te,"("+o(((w=(q=e.option.term)==null?void 0:q.division)==null?void 0:w.name)||b.$trans("general.all"))+")",1)):B("",!0)]}),_:1},8,["modelValue","label","options","error"])):B("",!0)]),k("div",ne,[d.isLoaded?(f(),A(O,{key:0,name:"batch",label:b.$trans("global.select",{attribute:b.$trans("academic.batch.batch")}),modelValue:r.batch,"onUpdate:modelValue":l[2]||(l[2]=e=>r.batch=e),error:c(s).batch,"onUpdate:error":l[3]||(l[3]=e=>c(s).batch=e),"value-prop":"uuid","init-search":d.batch,"search-key":"course_batch","search-action":"academic/batch/list",onChange:S},{selectedOption:t(e=>[g(o(e.value.course.name)+" "+o(e.value.name),1)]),listOption:t(e=>[g(o(e.option.course.nameWithTerm)+" "+o(e.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):B("",!0)]),k("div",oe,[i(a,{vertical:"",modelValue:r.showAllStudent,"onUpdate:modelValue":l[4]||(l[4]=e=>r.showAllStudent=e),name:"showAllStudent",label:b.$trans("global.list_all",{attribute:b.$trans("student.student")})},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},re={class:"p-2"},le={class:"divide-y divide-gray-200 dark:divide-gray-700"},ie={class:"col-span-4 sm:col-span-1"},me={class:"mt-1"},ce={key:0,class:"col-span-4 sm:col-span-3"},ue={name:"ExamComment"},pe=Object.assign(ue,{setup(N){const y=L(),h=P(),x=D();Q("emitter");const u={exam:"",batch:"",students:[]},_="exam/comment/",s=H(!1),r=U({exams:[]}),d=M(_),$=U({...u}),S=U({meta:{},showComment:!0}),b=async()=>{s.value=!0,await x.dispatch(_+"preRequisite").then(a=>{s.value=!1,Object.assign(r,a)}).catch(a=>{s.value=!1})},l=()=>{u.exam="",u.batch="",u.students=[],Object.assign($,j(u))},F=async()=>{y.query.batch&&(s.value=!0,await x.dispatch(_+"fetch",{params:y.query}).then(a=>{s.value=!1,u.exam=y.query.exam,u.batch=y.query.batch,u.students=a.data,S.meta=a.meta,Object.assign($,j(u))}).catch(a=>{s.value=!1}))},O=async()=>{await Y()&&(s.value=!0,await x.dispatch(_+"remove",{form:y.query}).then(a=>{s.value=!1,F()}).catch(a=>{s.value=!1}))};return T(async()=>{await b(),await F()}),(a,V)=>{const e=m("BaseButton"),q=m("PageHeaderAction"),w=m("PageHeader"),I=m("ParentTransition"),z=m("BaseAlert"),K=m("BaseCheckbox"),W=m("BaseDataView"),E=m("BaseInput"),G=m("FormAction"),J=m("BaseCard");return f(),C(R,null,[i(w,{title:a.$trans(c(y).meta.label),navs:[{label:a.$trans("exam.exam"),path:"Exam"}]},{default:t(()=>[i(q,null,{default:t(()=>[i(e,{design:"white",onClick:V[0]||(V[0]=n=>c(h).push({name:"ExamMark"}))},{default:t(()=>[g(o(a.$trans("exam.mark")),1)]),_:1}),i(e,{design:"white",onClick:V[1]||(V[1]=n=>c(h).push({name:"ExamObservationMark"}))},{default:t(()=>[g(o(a.$trans("exam.observation_mark")),1)]),_:1}),i(e,{design:"white",onClick:V[2]||(V[2]=n=>c(h).push({name:"ExamAttendance"}))},{default:t(()=>[g(o(a.$trans("student.attendance.attendance")),1)]),_:1})]),_:1})]),_:1},8,["title","navs"]),i(I,{appear:"",visibility:!0},{default:t(()=>[i(se,{onAfterFilter:F,onCancel:l,"init-url":_,"pre-requisites":r},null,8,["pre-requisites"])]),_:1}),i(J,{"no-padding":"","no-content-padding":"","is-loading":s.value},{title:t(()=>[g(o(a.$trans("exam.record")),1)]),action:t(()=>[S.meta.commentRecorded?(f(),A(e,{key:0,design:"error",onClick:O},{default:t(()=>[g(o(a.$trans("global.remove",{attribute:a.$trans("exam.comment")})),1)]),_:1})):B("",!0)]),default:t(()=>[k("div",re,[$.students.length==0?(f(),A(z,{key:0,size:"xs",design:"error"},{default:t(()=>[g(o(a.$trans("general.errors.record_not_found")),1)]),_:1})):B("",!0)]),$.students.length?(f(),A(G,{key:0,"no-card":"","button-padding":"","keep-adding":!1,"stay-on":!0,"init-url":_,action:"store","init-form":u,form:$},{default:t(()=>[k("div",le,[(f(!0),C(R,null,X($.students,(n,v)=>(f(),C("div",{class:"grid grid-cols-4 gap-6 px-4 py-2",key:n.uuid},[k("div",ie,[i(W,null,{default:t(()=>[g(o(n.name)+" ("+o(n.rollNumber||n.codeNumber)+") ",1),k("div",me,[i(K,{modelValue:n.isNotApplicable,"onUpdate:modelValue":p=>n.isNotApplicable=p,name:`students.${v}.isNotApplicable`,label:a.$trans("global.is_not",{attribute:a.$trans("exam.schedule.props.applicable")})},null,8,["modelValue","onUpdate:modelValue","name","label"])])]),_:2},1024)]),n.isNotApplicable?B("",!0):(f(),C("div",ce,[i(E,{type:"text",modelValue:n.result,"onUpdate:modelValue":p=>n.result=p,name:`students.${v}.result`,placeholder:a.$trans("exam.result"),error:c(d)[`students.${v}.result`],"onUpdate:error":p=>c(d)[`students.${v}.result`]=p},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"]),i(E,{type:"text",modelValue:n.comment,"onUpdate:modelValue":p=>n.comment=p,name:`students.${v}.comment`,placeholder:a.$trans("exam.comment"),error:c(d)[`students.${v}.comment`],"onUpdate:error":p=>c(d)[`students.${v}.comment`]=p},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"]),i(E,{type:"text",modelValue:n.inchargeComment,"onUpdate:modelValue":p=>n.inchargeComment=p,name:`students.${v}.inchargeComment`,placeholder:a.$trans("exam.incharge_comment"),error:c(d)[`students.${v}.inchargeComment`],"onUpdate:error":p=>c(d)[`students.${v}.inchargeComment`]=p},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))]))),128))])]),_:1},8,["form"])):B("",!0)]),_:1},8,["is-loading"])],64)}}});export{pe as default};
