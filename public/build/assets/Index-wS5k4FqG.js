import{u as J,m as S,I as Q,q as X,r as u,t as C,o as c,w as a,d as b,b as _,f,v as l,x as n,e as o,i as ie,j as ue,k as de,p as L,L as pe,a as U,z as K,F as O,y as W,N as ce,K as me}from"./app-Cvm44xuh.js";import{i as fe,t as be,a as ge}from"./table-FwhM-Z75.js";const ve={class:"grid grid-cols-3 gap-6"},ye={class:"col-span-3 sm:col-span-1"},_e={class:"col-span-3 sm:col-span-1"},Ce={class:"col-span-3 sm:col-span-1"},$e={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default:()=>({})}},emits:["hide"],setup(H,{emit:h}){const $=J(),w=h,k=H,m={name:"",batch:"",groups:[],showDetail:!0},v=S({...m}),B=Q(k.initUrl),g=S({batch:"",isLoaded:!($.query.batch||$.query.groups)});return X(async()=>{g.batch=$.query.batch,g.groups=$.query.groups?$.query.groups.split(","):[],g.isLoaded=!0}),(y,d)=>{const r=u("BaseSelectSearch"),i=u("BaseInput"),I=u("BaseSelect"),A=u("FilterForm");return c(),C(A,{"init-form":m,form:v,multiple:["groups"],onHide:d[4]||(d[4]=p=>w("hide"))},{default:a(()=>[b("div",ve,[b("div",ye,[g.isLoaded?(c(),C(r,{key:0,name:"batch",label:y.$trans("global.select",{attribute:y.$trans("academic.batch.batch")}),modelValue:v.batch,"onUpdate:modelValue":d[0]||(d[0]=p=>v.batch=p),error:f(B).batch,"onUpdate:error":d[1]||(d[1]=p=>f(B).batch=p),"value-prop":"uuid","init-search":g.batch,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:a(p=>[l(n(p.value.course.name)+" "+n(p.value.name),1)]),listOption:a(p=>[l(n(p.option.course.nameWithTerm)+" "+n(p.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):_("",!0)]),b("div",_e,[o(i,{type:"text",modelValue:v.name,"onUpdate:modelValue":d[2]||(d[2]=p=>v.name=p),name:"name",label:y.$trans("student.props.name")},null,8,["modelValue","label"])]),b("div",Ce,[o(I,{multiple:"",modelValue:v.groups,"onUpdate:modelValue":d[3]||(d[3]=p=>v.groups=p),name:"groups","label-prop":"name","value-prop":"uuid",label:y.$trans("student.group.group"),options:H.preRequisites.groups},null,8,["modelValue","label","options"])])])]),_:1},8,["form"])}}},ke={class:"p-2"},he={key:0,class:"far fa-circle-check fa-lg text-success"},Be={class:"grid grid-cols-3 gap-6 px-4 py-2"},Ve={class:"col-span-3 sm:col-span-1"},Fe={class:"col-span-3 sm:col-span-1"},Se={key:0,class:"col-span-3 sm:col-span-2"},we={class:"col-span-3 space-y-2"},Ae={class:"flex gap-2"},Te={class:"flex flex-wrap gap-y-2"},Ue={class:"grid grid-cols-3 gap-6 px-4 py-2"},qe={class:"col-span-3 sm:col-span-1"},He={name:"StudentFeeAllocation"},Ne=Object.assign(He,{setup(H){const h=J();ie();const $=ue();de("emitter");const w={batch:"",name:"",selectAll:!1,students:[],feeConcession:"",feeConcessionType:"",transportCircle:"",direction:"",optedFeeHeads:[]},k="student/feeAllocation/",m=L(!1),v=L(!1),B=L(!1),g=S({feeConcessions:[],feeConcessionTypes:[],transportCircles:[],directions:[],feeHeads:[],groups:[]}),y=Q(k),d=S({data:[]}),r=S({...w});S({});const i=S({...fe}),I=async()=>{m.value=!0,await $.dispatch(k+"preRequisite").then(s=>{m.value=!1,Object.assign(g,s)}).catch(s=>{m.value=!1})},A=async()=>{m.value=!0,await $.dispatch(k+"fetch",{params:h.query}).then(s=>{m.value=!1,r.batch=h.query.batch,r.name=h.query.name,Object.assign(d,s),i.pageItems=s.data.map(e=>e.uuid)}).catch(s=>{m.value=!1})},p=()=>{Object.assign(r,me(w))},Y=()=>{i.global=!i.global,r.selectAll=i.global},Z=()=>{r.optedFeeHeads=g.feeHeads.map(s=>s.uuid)},x=()=>{r.optedFeeHeads=[]},ee=async()=>{await ce()&&(m.value=!0,await $.dispatch(k+"remove",{form:r}).then(s=>{m.value=!1,D()}).catch(s=>{m.value=!1}))},D=async()=>{i.items=[],i.pageItems=[],i.all=!1,r.selectAll=!1,p(),await A()};return pe(()=>[i.items,i.pageItems],([s,e],[N,P])=>{r.students=s,i.all=ge(i)}),X(async()=>{await I(),h.query.batch&&await A()}),(s,e)=>{const N=u("DropdownItem"),P=u("PageHeaderAction"),te=u("PageHeader"),z=u("BaseImport"),q=u("ParentTransition"),ae=u("BaseAlert"),R=u("BaseCard"),E=u("BaseArrayCheckbox"),oe=u("BaseCheckbox"),V=u("DataCell"),T=u("TextMuted"),se=u("DataRow"),ne=u("DataTable"),le=u("BaseButton"),j=u("BaseSelect"),G=u("BaseLabel"),re=u("BaseRadioGroup"),M=u("FormAction");return c(),U(O,null,[o(te,{title:s.$trans(f(h).meta.label),navs:[{label:s.$trans("student.student"),path:"Student"}]},{default:a(()=>[o(P,{url:"students/",name:"Student",title:s.$trans(f(h).meta.label),actions:[],headers:[]},{dropdown:a(()=>[o(N,{icon:"fas fa-upload",onClick:e[0]||(e[0]=t=>v.value=!v.value)},{default:a(()=>[l(n(s.$trans("global.import",{attribute:s.$trans("finance.fee_head.custom_fee")})),1)]),_:1}),o(N,{icon:"fas fa-upload",onClick:e[1]||(e[1]=t=>B.value=!B.value)},{default:a(()=>[l(n(s.$trans("global.import",{attribute:s.$trans("finance.payment.payment")})),1)]),_:1})]),_:1},8,["title"])]),_:1},8,["title","navs"]),f(K)("fee:set")?(c(),C(q,{key:0,appear:"",visibility:v.value},{default:a(()=>[o(z,{path:"students/custom-fee-import",onCancelled:e[2]||(e[2]=t=>v.value=!1),onHide:e[3]||(e[3]=t=>v.value=!1),onCompleted:e[4]||(e[4]=()=>{})},{title:a(()=>[l(n(s.$trans("global.import",{attribute:s.$trans("finance.fee_head.custom_fee")})),1)]),_:1})]),_:1},8,["visibility"])):_("",!0),f(K)("fee-payment:import")?(c(),C(q,{key:1,appear:"",visibility:B.value},{default:a(()=>[o(z,{path:"students/fee-payment-import",onCancelled:e[5]||(e[5]=t=>B.value=!1),onHide:e[6]||(e[6]=t=>B.value=!1),onCompleted:e[7]||(e[7]=()=>{})},{title:a(()=>[l(n(s.$trans("global.import",{attribute:s.$trans("finance.payment.payment")})),1)]),_:1})]),_:1},8,["visibility"])):_("",!0),o(q,{appear:"",visibility:!0},{default:a(()=>[o($e,{onAfterFilter:A,"init-url":k,"pre-requisites":g},null,8,["pre-requisites"])]),_:1}),d.data.length==0?(c(),C(R,{key:2,"no-padding":"","no-content-padding":"","is-loading":m.value},{title:a(()=>[l(n(s.$trans("student.fee_allocation.fee_allocation")),1)]),default:a(()=>[b("div",ke,[o(ae,{size:"xs",design:"error"},{default:a(()=>[l(n(s.$trans("general.errors.record_not_found")),1)]),_:1})])]),_:1},8,["is-loading"])):_("",!0),d.data.length>0?(c(),C(q,{key:3,appear:"",visibility:!0},{default:a(()=>[o(ne,{onToggleSelectAll:e[10]||(e[10]=t=>i.items=f(be)(t,i)),onToggleGlobalSelect:Y,selected:i,header:d.headers,meta:d.meta,module:"student.fee_allocation",onRefresh:A},{actionButton:a(()=>e[20]||(e[20]=[])),default:a(()=>[(c(!0),U(O,null,W(d.data,t=>(c(),C(se,{key:t.uuid},{default:a(()=>[o(V,{name:"selectAll"},{default:a(()=>[i.global?_("",!0):(c(),C(E,{key:0,items:i.items,"onUpdate:items":e[8]||(e[8]=F=>i.items=F),value:t.uuid},null,8,["items","value"])),i.global?(c(),C(oe,{key:1,modelValue:i.global,"onUpdate:modelValue":e[9]||(e[9]=F=>i.global=F)},null,8,["modelValue"])):_("",!0)]),_:2},1024),o(V,{name:"codeNumber"},{default:a(()=>[l(n(t.codeNumber)+" ",1),t.feesCount?(c(),U("i",he)):_("",!0),o(T,{block:""},{default:a(()=>[l(n(t.joiningDate.formatted),1)]),_:2},1024)]),_:2},1024),o(V,{name:"name"},{default:a(()=>[l(n(t.name)+" ",1),o(T,{block:""},{default:a(()=>[l(n(t.gender.label),1)]),_:2},1024)]),_:2},1024),o(V,{name:"course"},{default:a(()=>[l(n(t.courseName)+" ",1),o(T,{block:""},{default:a(()=>[l(n(t.batchName),1)]),_:2},1024)]),_:2},1024),o(V,{name:"installmentCount"},{default:a(()=>[l(n(t.feesCount==0?"-":t.feesCount)+" ",1),o(T,{block:""},{default:a(()=>{var F;return[l(n(((F=t.feeConcessionType)==null?void 0:F.name)||""),1)]}),_:2},1024)]),_:2},1024),o(V,{name:"contactNumber"},{default:a(()=>[l(n(t.contactNumber)+" ",1),o(T,{block:""},{default:a(()=>[l(n(t.email),1)]),_:2},1024)]),_:2},1024),o(V,{name:"parent"},{default:a(()=>[l(n(t.fatherName)+" ",1),o(T,{block:""},{default:a(()=>[l(n(t.motherName),1)]),_:2},1024)]),_:2},1024),o(V,{name:"address"},{default:a(()=>[l(n(t.shortAddress),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["selected","header","meta"])]),_:1})):_("",!0),i.items.length>0?(c(),C(q,{key:4,appear:"",visibility:!0},{default:a(()=>[o(R,{"is-loading":m.value},{title:a(()=>[l(n(s.$trans("student.fee_allocation.fee_allocation")),1)]),action:a(()=>[o(le,{onClick:ee,size:"xs",design:"error"},{default:a(()=>[l(n(s.$trans("global.remove",{attribute:s.$trans("student.fee.fee")})),1)]),_:1})]),default:a(()=>[o(M,{"no-card":"","keep-adding":!1,"init-url":k,action:"allocate","init-form":w,form:r,"after-submit":D},{default:a(()=>[b("div",Be,[b("div",Ve,[o(j,{modelValue:r.feeConcession,"onUpdate:modelValue":e[11]||(e[11]=t=>r.feeConcession=t),name:"feeConcession",label:s.$trans("finance.fee_concession.fee_concession"),options:g.feeConcessions,"label-prop":"name","value-prop":"uuid",error:f(y).feeConcession,"onUpdate:error":e[12]||(e[12]=t=>f(y).feeConcession=t)},null,8,["modelValue","label","options","error"])]),b("div",Fe,[o(j,{modelValue:r.transportCircle,"onUpdate:modelValue":e[13]||(e[13]=t=>r.transportCircle=t),name:"transportCircle",label:s.$trans("transport.circle.circle"),options:g.transportCircles,"label-prop":"name","value-prop":"uuid",error:f(y).transportCircle,"onUpdate:error":e[14]||(e[14]=t=>f(y).transportCircle=t)},null,8,["modelValue","label","options","error"])]),r.transportCircle?(c(),U("div",Se,[o(G,null,{default:a(()=>[l(n(s.$trans("transport.circle.direction")),1)]),_:1}),o(re,{"top-margin":"",options:g.directions,name:"direction",modelValue:r.direction,"onUpdate:modelValue":e[15]||(e[15]=t=>r.direction=t),error:f(y).direction,"onUpdate:error":e[16]||(e[16]=t=>f(y).direction=t),horizontal:""},null,8,["options","modelValue","error"])])):_("",!0),b("div",we,[o(G,null,{default:a(()=>[l(n(s.$trans("student.fee.opted_fee"))+" ",1),b("div",Ae,[b("span",{onClick:Z,class:"cursor-pointer"},n(s.$trans("general.select_all")),1),b("span",{onClick:x,class:"cursor-pointer"},n(s.$trans("general.unselect_all")),1)])]),_:1}),b("div",Te,[(c(!0),U(O,null,W(g.feeHeads,t=>(c(),U("div",{class:"w-1/3",key:t.uuid},[o(E,{items:r.optedFeeHeads,"onUpdate:items":e[17]||(e[17]=F=>r.optedFeeHeads=F),value:t.uuid,label:t.name},null,8,["items","value","label"])]))),128))])])])]),_:1},8,["form"])]),_:1},8,["is-loading"]),o(R,{class:"mt-4","is-loading":m.value},{title:a(()=>[l(n(s.$trans("finance.fee_concession.type.type")),1)]),action:a(()=>e[21]||(e[21]=[])),default:a(()=>[o(M,{"no-card":"","keep-adding":!1,"init-url":k,action:"allocateFeeConcessionType","init-form":w,form:r,"after-submit":D},{default:a(()=>[b("div",Ue,[b("div",qe,[o(j,{modelValue:r.feeConcessionType,"onUpdate:modelValue":e[18]||(e[18]=t=>r.feeConcessionType=t),name:"feeConcessionType",label:s.$trans("finance.fee_concession.type.type"),options:g.feeConcessionTypes,"label-prop":"name","value-prop":"uuid",error:f(y).feeConcessionType,"onUpdate:error":e[19]||(e[19]=t=>f(y).feeConcessionType=t)},null,8,["modelValue","label","options","error"])])])]),_:1},8,["form"])]),_:1},8,["is-loading"])]),_:1})):_("",!0)],64)}}});export{Ne as default};
